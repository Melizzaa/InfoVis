
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> 

   <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
   <title>InfoVis</title>
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   <link rel="stylesheet" href="style.css">

   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

   <script type="text/javascript" src="d3/d3.js" charset="utf-8"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   <script src="RadarChart.js"></script>
   <script src="d3/d3.slider.js"></script>


   

   <!-- Leaflet -->
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />



   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>
   <body>
   	<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    
    <div class="overlay">
       <div class="jumbotron">
          <div class="text-center">
            <h1>An interactive housing guide</h1>
            <h2>For those unknown to Amsterdam</h2>
          </div>
       </div>
      <div class="row">
        <div class="col-md-6 col-md-offset-3 text-center">
          <h3>Who are you?</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 text-center">
          <figure><image src ="student_c.png"/ onclick="changeStudent()" width="200" height="200" id="student" ></figure>
          <h2>Student</h2>
          Low house prices</br>
          Exciting living area</br>
        
        </div>
        <div class="col-md-4 text-center">
          <figure><image src ="family_c.png"/ onclick="changeFamily()" width="200" height="200" id="family" ></figure>
          <h2>Family</h2>
          A safe neighbourhood with many children</br>
          Outdoor Playgrounds</br>
          
        </div>
        <div class="col-md-4 text-center">
          <figure><image src ="professional_c.png"/ onclick="changeProfessional()" width="200" height="200" id="professional" ></figure>
          <h2>Professional</h2>
            Life close to work</br>
            Cultural activities</br>
            
        </div>

      </div><!-- row -->
    </div><!-- overlay -->
      <div class="">
        <div class="jumbotron">
            <div class="text-center">
              <h1>An interactive housing guide</h1>
              <h2>For those unknown to Amsterdam</h2>
            </div>
         </div>
         <div class="">
            <div class="col-md-2 sliderArea text-center">
              <p class="text-justify"></p>        
                <form id="back-button-form" style="position:relative;"> <!--back to homescreen button-->
                  <input class="btn btn-default" type="button" onClick="history.go(0)" value="Start screen" style="position: absolute; left:0;">
                </form>
                <figure><img src="house_c.png" id="toChange" height="80" width="80" hspace="100"/></figure>
                <!-- START SLIDERS -->

                
                <!-- <div id="weightDistance"></div> -->

                <div id="sliderSafety"></div>
                <p>Safety</p>
                
                <div id="sliderPrice"></div>
                <p>Housing Price</p>

                <div id="sliderBars"></div>
                <p>Bars and Restaurants</p>
                
                 <div id="sliderMuseum"></div>
                <p>Museums and Galleries</p>

                <div id="sliderPlaygrounds"></div>
                <p>Playgrounds</p>


                <div id="sliderPark"></div>
                <p>Park</p>

                <div id="sliderChildren"></div>
                <p>Amount of Children</p>

               
              </div> <!-- col area -->
            <div class="col-md-7 text-center">
               <div class="area">
                <div id="map"></div>
             </div>
            </div>
            <div class="col-md-3">
               <div class="area">
                <!--<form name="myform" onSubmit="return handleClick()">
                <input type="text" id="myVal" placeholder="Enter a location&hellip;">
                <input name="Submit"  type="submit" value="Add to map" >
                </form>-->
                <form action="javascript:void(-1)">
                  <div class="form-group">
                    <label>I want to live</label>
                    <div id="sliderDistance"></div>
              <div id="sliderDistance"></div>
                <p>minutes away from:</p>
                    <input id="pac-input" class="form-control input-lg controls" type="text" placeholder="Search for an address&hellip;" value="">
                    <input type="button" id ="but" value="Search" class="tfbutton">
                    <label id="errorMessage"></label>
                  </div>
                </form>
                <script>

					// draw without distance 
					
					// draw with distance
					var travelTimes = [];
					var weightsArray = [];
					var travelNorm = [];
					function getTravelTime(query,weights) {
						weightsArray = weights;
						if (query.length === 0) {
							normTravelTimes = Array.apply(null, Array(97)).map(Number.prototype.valueOf,0);
							travelTimes = [];
							}
			
						else {	
							travelTimes = [];
							query_lowercase = query.toLowerCase();
							if (query_lowercase.indexOf('amsterdam') === -1) {
								query_lowercase += ' amsterdam'
							}
							destinationA = query_lowercase;
							console.log("destination", destinationA);
    						function test(origins,destinationA) {
    							var service = new google.maps.DistanceMatrixService();
    							var d = $.Deferred();
								service.getDistanceMatrix(
  								{
   			 						origins: [origins],
    								destinations: [destinationA],
    								travelMode: google.maps.TravelMode.TRANSIT, //options:BICYCLING,TRANSIT,WALKING
  								}, function(response, status) {
          							if (status !== google.maps.DistanceMatrixStatus.OK) {
            							alert('Error was: ' + status);
            							d.reject(status);
          							} else {
          								d.resolve(response);
        									}
    							});
    							return d.promise();
    						}
    		
    						var travelTime = 0;
    						var centroids = [[52.372912, 4.898026], [52.373327, 4.89554], [52.37287, 4.88705], [52.36561, 4.89501], [52.372469, 4.905261], [52.384063, 4.889956], [52.374241, 4.880121], [52.361939, 4.889067], [52.363089, 4.912681], [52.370914, 4.920347], [52.392812, 4.880943], [52.389711, 4.872233], [52.382119, 4.873687], [52.381002, 4.866368], [52.376688, 4.87353], [52.370856, 4.872788], [52.36822, 4.865476], [52.365512, 4.868423], [52.363901, 4.874014], [52.359584, 4.860074], [52.361333, 4.874088], [52.38034, 4.854727], [52.376446, 4.851146], [52.376854, 4.843527], [52.370459, 4.86189], [52.371749, 4.849023], [52.366523, 4.853068], [52.361734, 4.85377], [52.381865, 4.829113], [52.372995, 4.819509], [52.378913, 4.802518], [52.380099, 4.7798], [52.365576, 4.778243], [52.359578, 4.810085], [52.354254, 4.795585], [52.358176, 4.784008], [52.3454, 4.792493], [52.358274, 4.825306], [52.366039, 4.84384], [52.34562, 4.842159], [52.341956, 4.819172], [52.356262, 4.893802], [52.352003, 4.897372], [52.350608, 4.902259], [52.347937, 4.847204], [52.349234, 4.85362], [52.354257, 4.864179], [52.356392, 4.878474], [52.344917, 4.858033], [52.346471, 4.878571], [52.353078, 4.884948], [52.342341, 4.896172], [52.347808, 4.905239], [52.340018, 4.905159], [52.34361, 4.877624], [52.331295, 4.856203], [52.330024, 4.885042], [52.35452, 4.911626], [52.35977, 4.916632], [52.362408, 4.929334], [52.353589, 4.918915], [52.362263, 4.935066], [52.364035, 4.951746], [52.375438, 4.944613], [52.361313, 4.974577], [52.366841, 4.991391], [52.349781, 5.005375], [52.346683, 4.924886], [52.352977, 4.953268], [52.340466, 4.94338], [52.334782, 4.913103], [52.392968, 4.910914], [52.388329, 4.922624], [52.390456, 4.943842], [52.392574, 4.929696], [52.391729, 4.935123], [52.41282, 4.891063], [52.418493, 4.883964], [52.415473, 4.903968], [52.394668, 4.955175], [52.402945, 4.941547], [52.405382, 4.915775], [52.399223, 4.897008], [52.401458, 4.986586], [52.301489, 4.949528], [52.317097, 4.950076], [52.322577, 4.977048], [52.306996, 4.993351], [52.297666, 4.975965], [52.296847, 4.989114], [52.310243, 5.011796]];
    						var originArray = [];
    						for (var k=0;k<centroids.length;k++) {
    							var lat = centroids[k][0];
    							var lon = centroids[k][1];
    							var origin = new google.maps.LatLng(lat, lon);
    							originArray.push(origin);
    						}
    		
    						for (var i = 0;i<centroids.length;i++) {
    							var origin = originArray[i];
    							test(origin,destinationA)
    								.done(function(response) {
    									var origins = response.originAddresses;
    									var destinations = response.destinationAddresses;
    					
										if (destinations[0] != "Amsterdam, Netherlands") {
						
    									for (var i = 0; i < origins.length; i++) {
      										var results = response.rows[i].elements;
      										console.log('length',results.length);
      										for (var j = 0; j < results.length; j++) { //go through results
      											console.log("j",j);
      											var element = results[j];
        										var distance = element.distance.text;
        										var duration = element.duration.text;
        										var durationMin = 0;
												var var1 =  duration.indexOf('hours'); 
												if (var1 == -1) {
													var var2 = duration.indexOf('hour');
													if (var2 == -1) { // only minutes{
														var var3 = duration.indexOf('min');
														var totalMins = duration.substring(0,(var3-1));
													}
													else {
														var hours = duration.substring(0,(var2-1));
														var var3 = duration.indexOf('min');
														var mins = duration.substring((var2+5),(var3-1));
														var totalMins = parseInt(hours)*60 + parseInt(mins);
													}				
												}
												else {
													var hours = duration.substring(0,(var1-1));
													var var2 = duration.indexOf('min');
													var mins = duration.substring((var1+6),(var2-1));
													var totalMins = parseInt(hours)*60 + parseInt(mins);
													//console.log(hours,mins);
												}
												//console.log("total",totalMins);
        										var from = origins[i];
        										var to = destinations[j];
        										travelTime = totalMins
        										console.log("time",travelTime);
        										travelTimes.push(parseInt(travelTime));
        										console.log("trave;",travelTimes);
        									}
        								}
        							}// end if destination not Amsterdam
    							})
    						}//end for loop centroids
    							
    					}//end else
    					var destinationFound = false;
    						
    					setTimeout('run()',20000);
    				}
    		
    						
    						function run() {
    							console.log("TRAVEL",travelTimes);	
    							normalise(travelTimes);
    						}
    			
    						function normalise(travelTimes) {
    							if (travelTimes.length === 0) {
    								destinationFound = false;
    							}
    							else {
    								destinationFound = true;
    								var normTravelTimes = [];
    								var maxTime = Math.max.apply(null,travelTimes);
    								var minTime = Math.min.apply(null,travelTimes);
    								//console.log("min",minTime,"max",maxTime);
    								for (var n=0;n<travelTimes.length;n++) {
    									normTime = 1-((travelTimes[n]-minTime)/(maxTime-minTime));
    									//console.log("normTime",normTime);
    									normTravelTimes.push(Math.round(normTime*100)/100);	
    								}
    							console.log("JIPPIE",travelTimes, travelTimes.length);
    							console.log("norm",normTravelTimes,normTravelTimes.length);
    							console.log("weightsArray?:",weightsArray);
    							scoringF(allHoods,weightsArray,normTravelTimes);
    							travelNorm = normTravelTimes;
    							
    							}
    							console.log(destinationFound);
    							if (destinationFound === false) {
    								document.getElementById("errorMessage").innerHTML = "This address could not be found.";
    							}
    						}

					
				</script>            
                <div id="chart"></div>
                <div id="loader_container"></div>
             </div>
            </div>
        </div>
     </div><!-- Container -->



<script type="text/javascript"> //script overlay

// [distance, safety, house pricing, bars, musea, playgrounds, parks, percentage households children]

var SetWeightsStudent = [0, -1, 1, 1, -1, -1, 1, 0];
var SetWeightsFamily = [1, 1, -1, -1, 0, 1, 1, 1];
var SetWeightsProfessional = [1, 0, -1, 1, 1, -1, 0, -1];
var SetWeightsNone=[0,0,0,0,0,0,0,0];



$(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "data/all.csv",
        dataType: "text",
        success: function(data) {
          allHoods = processData(data);
        }
      });
    });

    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];

      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }

      return lines;

    }
    
      
var chosenWeights;
$("#student, close").on('click', function () {
  createSliders(SetWeightsStudent);
  chosenWeights = SetWeightsStudent;
  scoringF(allHoods,SetWeightsStudent,[]);
  overlay.fadeOut();
}); 

$("#family, close").on('click', function () {
  createSliders(SetWeightsFamily);
  scoringF(allHoods,SetWeightsFamily,[]);
  overlay.fadeOut();
}); 

$("#professional, close").on('click', function () {
  createSliders(SetWeightsProfessional);
  scoringF(allHoods,SetWeightsProfessional,[]);
  overlay.fadeOut();

}); 

var overlay = $('.overlay'),
    close = $('<button type="button" class="col-md-6 col-md-offset-3 btn btn-primary btn-lg closeOverlay">Let me explore it myself</buton>').on('click', function (){
  createSliders(SetWeightsNone);
  scoringF(allHoods,SetWeightsNone);
  overlay.fadeOut();

}); 

overlay.append(close);  

</script>

    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>  
    <script type="text/javascript">
    // MAP

    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];

      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }

      return lines;

    }

    
    



    // neighbourhood
    // neighbourhood name
    // coordinates neighbourhood
    // safety
    // normalised safety
    // house price
    // normalised prices score
    // number of bars and restaurants
    // normalised number of bars and restaurants
    // list of bars and restaurants
    // number of musea
    // normalised number of musea
    // list of musea
    // number of playgrounds
    // normalised number of playgrounds
    // number of parks
    // normalised number of parks
    // list of parks
    // % households with children
    // normalised % households with children

  
    var hoodReferences = []; //used to delete the polygon objects before creating new ones.

    function plotHoodsScores(allHoods, scoresArray, index, best, min, max) {
      removePolygons(hoodReferences);
      hoodReferences = [];
      var localMin = min;
      var localMax = max;
      var allZero = true;
      
      for (var i = 0; i < scoresArray.length; i++){
          if(scoresArray[i] != 0)
          allZero = false;
      }
      
      if (allZero){
      for (var i = 0; i < allHoods.length; i++){
        var hood = polygonHoodZeros(allHoods[i]);
        hoodReferences.push(hood);
        }      
      } else {
           for (var i = 0; i < allHoods.length; i++) {
        
           if (i == index[0] || i == index[1] || i == index[2] || i == index[3] || i == index[4]) {
               var hood = polygonHoodBestScores(allHoods[i]);
              hoodReferences.push(hood);
           } else {
                 var hood = polygonHoodScores(allHoods[i],scoresArray[i], localMin, localMax);
                 hoodReferences.push(hood);
           
               }   
           } 
      }
    }
    
      function polygonHoodZeros(data) {
      return L.polygon(
        eval(data[2]),
        styleZeros())
        .addTo(map)
        .bindPopup(getPopoverText(data));
    }
    
    function styleZeros() {
      return {
        fillColor: '#66c2a4',
        weight: 1.5,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.80
      };
    }

  function polygonHoodBestScores(data) {
      return L.polygon(
        eval(data[2]),
        styleBest())
        .addTo(map)
        .bindPopup(getPopoverText(data));
    }
    
     function styleBest() {
      return {
        fillColor: '#006d2c',
        weight: 1.5,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.80
      };
    }
    
    function removePolygons(polygons) {
      for (var i = 0; i < polygons.length; i++) {
        map.removeLayer(polygons[i]);
      }
    }

    function polygonHoodScores(data,scoringValue, min, max) {
      return L.polygon(
        eval(data[2]),
        style2(scoringValue, min, max))
        .addTo(map)
        .bindPopup(getPopoverText(data));
    }

      function style2(color, min, max) {
      return {
        fillColor: getColor2(color, min, max),
        weight: 1.5,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.80
      };
    }
    
    function getColor2(d, min, max) {
       interval = Math.abs(max-min)/4;
      //d = d*100
      //if (d>max) return '#006d2c';
      if (d>= (min + 3*interval) && d<max) return '#2ca25f';
      if (d>= (min + 2*interval) && d<(min + 3*interval)) return '#66c2a4';
      if (d>= (min + interval) && d<(min + 2*interval)) return '#b2e2e2';
      if (d >= min && d< (min+interval)) return '#edf8fb';
      return '#edf8fb';
      }
      

   

    function getColor(d) {
        return d > 1000 ? '#800026' :
               d > 500  ? '#BD0026' :
               d > 200  ? '#E31A1C' :
               d > 100  ? '#FC4E2A' :
               d > 50   ? '#FD8D3C' :
               d > 20   ? '#FEB24C' :
               d > 10   ? '#FED976' :
                          '#FFEDA0';
    }


    function getPopoverText(data) {
      var text = "<h3>" + data[1] + "</h3>" +
      "<table class='table table-hover table-condensed'>" + 
      "<thead><tr><th>Property</th><th>Value</th></tr></thead>" +
      "<tbody>" +
      "<tr><td>Safety grade</td><td><a href=\"#\" data-toggle=\"tooltip\" title=\"\" data-original-title=\"10 = Amsterdams savest neighbourhood; 0 = Amsterdams least save neighbourhood\" data-placement=\"right\" data-container=\"body\">" + Math.round(data[4] * 10) + "/10</a></td></tr>"+

      "<tr><td>Housing price</td><td><a href=\"#\" data-toggle=\"tooltip\" title=\"\" data-original-title=\"10 = Amsterdams most affordable neighbourhood; 0 = Amsterdams most expensive neighbourhood\" data-placement=\"right\" data-container=\"body\">"  + Math.round(data[6]*10) + " /10</a></td></tr>" +


      "<tr><td>Number of bars and restaurants</td><td>" + Math.round(data[7]) + "</td></tr>" +
      "<tr><td>Number of musea</td><td>" + Math.round(data[10]) + "</td></tr>" +
      "<tr><td>Number of playgrounds</td><td>" + Math.round(data[13]) + "</td></tr>" +
      "<tr><td>Number of parks</td><td>" + Math.round(data[15]) + "</td></tr>" +
      "<tr><td>Percentage households with children</td><td>" + data[18] + "%</td></tr>" +
      "</tbody>" +
      "</table>";
      return text;
    }

  
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    var map = L.map('map').setView([52.356312, 4.892006], 12);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(map);

    
    var legend = L.control({position: 'bottomleft'});
    legend.onAdd = function (map) {

        var div = L.DomUtil.create('div', 'info legend'),
            grades = [1, 3, 5, 7,9];
            labels = [];

        div.innerHTML += "<div id='legendText'>Recommended neighbourhoods</div><svg id='legendArrow' width='250px' height='14px'><defs><marker id='arrow' markerWidth='10' markerHeight='10' refX='0' refY='3' orient='auto' markerUnits='strokeWidth'><path d='M0,0 L0,6 L9,3 z' fill='#000'></path></marker></defs><line x1='5' y1='6' x2='220' y2='6' stroke='#000' stroke-width='2' marker-end='url(#arrow)''></line></svg>";

        // loop through our density intervals and generate a label with a colored square for each interval
        for (var i = 0; i < grades.length; i++) {
          var clearfix = "clear: both";
          if (i == 0) {
            div.innerHTML +=
                '<i style="background:' + getColor2(grades[i], 0, 10) + '; clear: both; "></i> ';
          } else {
            div.innerHTML +=
                '<i style="background:' + getColor2(grades[i], 0, 10) + '"></i> ';
          }
        }

        div.innerHTML +=
                '<i style="background:#006d2c"></i> ';

        return div;
    };

    legend.addTo(map);

    map.on('popupopen', function(openEvent){
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();              // initialize popover
            $('#popup-close').on('click', function(){            // listen for click on close
                $('[data-toggle="tooltip"]').tooltip('destroy'); // destroy popover
                map.closePopup();                                // close popup
            });
        });
    });


    //L.marker([52.355054, 4.954834]).addTo(map).bindPopup("<b>Hello!</b><br />I am at Science Park.").openPopup();

    var popup = L.popup();

    function onMapClick(e) {
      popup
      .setLatLng(e.latlng)
      .setContent("You clicked the map at " + e.latlng.toString())
      .openOn(map);
    }

    //map.on('click', onMapClick);

     </script>


    <script type="text/javascript"> //This is the search bar
 
      // This example adds a search box to a map, using the Google Place Autocomplete
      // feature. People can enter geographical searches. The search box will return a
      // pick list containing a mix of places and predicted search terms.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function initAutocomplete() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -33.8688, lng: 151.2195},
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        // Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        var markers = [];
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }

          // Clear out the old markers.
          markers.forEach(function(marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });
      }

    </script>




    
     <script type="text/javascript"> //SLIDERS: each Slider gives a weight value between -2 and 2
    
     
      $(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "data/all.csv",
        dataType: "text",
        success: function(data) {
          allHoods = processData(data);
          
        }
      });
    });
   
    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];
      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }
      return lines;
    }
     var query = "";
     function createSliders(weights) {

      d3.select('#sliderDistance').call(d3.slider().value(weights[0]).on("slide", function(evt, value) {
          weights[0] = value;
          d3.select('#weightDistance').text(value);
          console.log("sliders says:",weights);
			var query = "";
                
			var buttonpressed = document.getElementById('but');
			buttonpressed.onclick = function(e) {
				document.getElementById("errorMessage").innerHTML = "";
				//e.preventDefault();
				query = document.getElementById('pac-input').value;
				console.log("query",query); 
				getTravelTime(query,weights); 
			}	
          //scoringF(allHoods,weights);
          }));
      d3.select('#sliderSafety').call(d3.slider().value(weights[1]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[1] = value;
          d3.select('#weightSafety').text(value);
          scoringF(allHoods,weights,[]);}));
      d3.select('#sliderPrice').call(d3.slider().value(weights[2]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[2] = value;
          d3.select('#weightPrice').text(value);
          scoringF(allHoods,weights,[]);
          console.log("q",query);
          console.log("test",travelNorm);
          
          })); 
      d3.select('#sliderBars').call(d3.slider().value(weights[3]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[3] = value;
          d3.select('#weightBars').text(value);
          scoringF(allHoods,weights,[]);}));
      d3.select('#sliderMuseum').call(d3.slider().value(weights[4]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[4] = value;
          d3.select('#weightMuseum').text(value);
          scoringF(allHoods,weights,[]);}));
      d3.select('#sliderPlaygrounds').call(d3.slider().value(weights[5]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[5] = value;
          d3.select('#weightPlaygrounds').text(value);
          scoringF(allHoods,weights,[]);}));
      d3.select('#sliderPark').call(d3.slider().value(weights[6]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[6] = value;
          d3.select('#weightPark').text(value);
          scoringF(allHoods,weights,[]);}));
      d3.select('#sliderChildren').call(d3.slider().value(weights[7]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[7] = value;
          d3.select('#weightChildren').text(value);
          scoringF(allHoods,weights,[]);}));
          //.on("change", function(){weightValues[6] = this.value;  }));
     
               
    }
    
    
function scoringF(allHoods,weights,normTravelTimes){

var scores1 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores2 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores3 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores4 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores5 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scoresNeigh = new Array();
var scores = Array.apply(null, Array(allHoods.length)).map(Number.prototype.valueOf,0);
//console.log("scores length: " + scores.length);
for (var i=0; i<allHoods.length; i++){
   console.log("scoring has started");
	for (var i=0; i<allHoods.length; i++){
		if (normTravelTimes.length === 0) { //no (new) location query is given
			console.log("no query given");
			if (travelNorm.length === 0) { //if no location has been submitted earlier
  				scores[i] = weights[1]*parseFloat(allHoods[i][4]) + weights[2]*parseFloat(allHoods[i][6]) + weights[3]*parseFloat(allHoods[i][8]) + weights[4]*parseFloat(allHoods[i][11]) + weights[5]*parseFloat(allHoods[i][14]) + weights[6]*parseFloat(allHoods[i][16]) + weights[7]*parseFloat(allHoods[i][19]) ;
			}
			else { //there has been a query submitted earlier
				console.log("earlier query");
				scores[i] = weights[0]*travelNorm[i] + weights[1]*parseFloat(allHoods[i][4]) + weights[2]*parseFloat(allHoods[i][6]) + weights[3]*parseFloat(allHoods[i][8]) + weights[4]*parseFloat(allHoods[i][11]) + weights[5]*parseFloat(allHoods[i][14]) + weights[6]*parseFloat(allHoods[i][16]) + weights[7]*parseFloat(allHoods[i][19]) ;
			}
		}
		else { //a location query has just been submitted
			console.log("new query!");
			scores[i] = weights[0]*normTravelTimes[i] + weights[1]*parseFloat(allHoods[i][4]) + weights[2]*parseFloat(allHoods[i][6]) + weights[3]*parseFloat(allHoods[i][8]) + weights[4]*parseFloat(allHoods[i][11]) + weights[5]*parseFloat(allHoods[i][14]) + weights[6]*parseFloat(allHoods[i][16]) + weights[7]*parseFloat(allHoods[i][19]) ;
		}
	}
}

console.log("scores: " + scores);
var best = Array.apply(null, Array(5)).map(Number.prototype.valueOf,0);
var index = Array.apply(null, Array(5)).map(Number.prototype.valueOf,0);
for (var q =0; q<best.length; q++){
	best[q] = scores[q];
	index[q] = q;
}
for (var j = 0; j < best.length-1; j++) {
    var iMin = j;
    for (var i = j+1; i < best.length; i++) {
        if (best[i] < best[iMin]) {
            iMin = i;
        }
    }
    if(iMin != j) {
        var temp = best[j];
        best[j] = best[iMin];
        best[iMin] = temp;
        var temp2 = index[j];
        index[j] = index[iMin];
        index[iMin] = temp2;
    }
}
for (var i=5; i<scores.length; i++){
		value = scores[i];
    position = -1
    for (var j=0; j<best.length; j++){
  	   	 var k = 4-j;
         if (value>best[k]){
             position =k;
			       break;      
         }
    }
	  if (position>=0){
		    for (var m=0; m<position; m++){
		         best[m] = best[m+1];
		         index[m] = index[m+1];
        }
		    best[position] = value;
		    index[position] = i;
    }
}  


var minScores = 16;
for (var j=0; j<scores.length; j++){
    if (scores[j]<minScores)
        minScores = scores[j];
}

var maxScores = -16;
for (var j=0; j<scores.length; j++){
    if ((scores[j]>maxScores) && (scores[j] < best[0]))
         maxScores = scores[j]; 
}
console.log("min: " + minScores+" max: " + maxScores);
var ind = [4,6,8,11,14,16,19];  //correspondence with #column for normalized values in csv file
for (var i=0;i<ind.length;i++){
     
     scores1[i+1] = allHoods[index[0]][ind[i]]; 
     if (scores1[i+1]==0) scores1[i+1] = 0.1;
     scores2[i+1] = allHoods[index[1]][ind[i]];
       if (scores2[i+1]==0) scores2[i+1] = 0.1;
     scores3[i+1] = allHoods[index[2]][ind[i]];
       if (scores3[i+1]==0) scores3[i+1] = 0.1;
     scores4[i+1] = allHoods[index[3]][ind[i]];
       if (scores4[i+1]==0) scores4[i+1] = 0.1;
     scores5[i+1] = allHoods[index[4]][ind[i]];
       if (scores5[i+1]==0) scores5[i+1] = 0.1;
} 
for (var j = 0; j<5; j++){
//console.log(allHoods[index[j]][0]);
scoresNeigh.push(allHoods[index[j]][1]);
}

console.log("index "+index);
plotHoodsScores(allHoods, scores, index, best, minScores, maxScores);


a = setVariabled(scores1, scores2, scores3, scores4, scores5);

 var mycfg = {
        w: 350,
        h: 350,
        maxValue: 10,
        levels: 5,
        ExtraWidthX: 300
      }

RadarChart.draw("#chart", a, mycfg);

var colorscale = d3.scale.category10();
setLegend(scoresNeigh);

return;

}

</script>

<script language="javascript"> //this is the radar chart
      var RadarChart = {
        draw: function(id, d, options){
        var cfg = {
         radius: 3, //size dot
         w: 600, 
         h: 600,
         factor: 1, //zoom in within specified box
         factorLegend: .75, //distance variable name to line
         levels: 3,
         maxValue: 0,
         radians: 2 * Math.PI, //makes it a cirle shape
         opacityArea: 0.3, //of the polygons
         ToRight: 5, //digit index from middle line
         TranslateX: 35, //in box
         TranslateY: 55,
         ExtraWidthX: 100,
         ExtraWidthY: 300,
         color: d3.scale.category10()
        };
        
        if('undefined' !== typeof options){
          for(var i in options){
          if('undefined' !== typeof options[i]){
            cfg[i] = options[i];
          }
          }
        }
        cfg.maxValue = Math.max(cfg.maxValue, d3.max(d, function(i){return d3.max(i.map(function(o){return o.value;}))}));
        var allAxis = (d[0].map(function(i, j){return i.axis}));
        var total = allAxis.length;
        var radius = cfg.factor*Math.min(cfg.w/2, cfg.h/2);
        var Format = d3.format('8,.0f'); //format of legend in radar
        d3.select(id).select("svg").remove();
        
        var g = d3.select(id)
            .append("svg")
            .attr("width", cfg.w+cfg.ExtraWidthX)
            .attr("height", cfg.h+cfg.ExtraWidthY)
            .append("g")
            .attr("transform", "translate(" + cfg.TranslateX + "," + cfg.TranslateY + ")");
            ;

        var tooltip;
        
        //Circular segments
        for(var j=0; j<cfg.levels-1; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data(allAxis)
           .enter()
           .append("svg:line")
           .attr("x1", function(d, i){return levelFactor*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
           .attr("y1", function(d, i){return levelFactor*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
           .attr("x2", function(d, i){return levelFactor*(1-cfg.factor*Math.sin((i+1)*cfg.radians/total));})
           .attr("y2", function(d, i){return levelFactor*(1-cfg.factor*Math.cos((i+1)*cfg.radians/total));})
           .attr("class", "line")
           .style("stroke", "black")
           .style("stroke-opacity", "0.75")
           .style("stroke-width", "0.3px") 
           .attr("transform", "translate(" + (cfg.w/2-levelFactor) + ", " + (cfg.h/2-levelFactor) + ")");
        }

        //Text indicating at what % each level is
        for(var j=0; j<cfg.levels; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data([1]) //dummy data
           .enter()
           .append("svg:text")
           .attr("x", function(d){return levelFactor*(1-cfg.factor*Math.sin(0));})
           .attr("y", function(d){return levelFactor*(1-cfg.factor*Math.cos(0));})
           .attr("class", "legend")
           .style("font-family", "sans-serif")
           .style("font-size", "10px")
           .attr("transform", "translate(" + (cfg.w/2-levelFactor + cfg.ToRight) + ", " + (cfg.h/2-levelFactor) + ")")
           .attr("fill", "#000000")
           .text(Format((j+1)*cfg.maxValue/cfg.levels));
        }
        
        series = 0;

        var axis = g.selectAll(".axis")
            .data(allAxis)
            .enter()
            .append("g")
            .attr("class", "axis");

        axis.append("line")
          .attr("x1", cfg.w/2)
          .attr("y1", cfg.h/2)
          .attr("x2", function(d, i){return cfg.w/2*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
          .attr("y2", function(d, i){return cfg.h/2*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
          .attr("class", "line")
          .style("stroke", "grey")
          .style("stroke-width", "1px");

        axis.append("text")
          .attr("class", "legend")
          .text(function(d){return d})
          .style("font-family", "sans-serif")
          .style("font-size", "14px")
          .attr("text-anchor", "middle")
          .attr("dy", "1.5em")
          .attr("transform", function(d, i){return "translate(0, -10)"})
          .attr("x", function(d, i){return cfg.w/2*(1-cfg.factorLegend*Math.sin(i*cfg.radians/total))-60*Math.sin(i*cfg.radians/total);})
          .attr("y", function(d, i){return cfg.h/2*(1-Math.cos(i*cfg.radians/total))-20*Math.cos(i*cfg.radians/total);});

       
        d.forEach(function(y, x){
          dataValues = [];
          g.selectAll(".nodes")
          .data(y, function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
            ]);
          });   
          
          dataValues.push(dataValues[0]);
          g.selectAll(".area")
                 .data([dataValues])
                 .enter()
                 .append("polygon")
                 .attr("class", "radar-chart-serie"+series)
                 .style("stroke-width", "1px")
                 .style("stroke", cfg.color(series))
                 .attr("points",function(d) {
                   var str="";
                   for(var pti=0;pti<d.length;pti++){
                     str=str+d[pti][0]+","+d[pti][1]+" ";
                   }
                   return str;
                  })
                 .style("fill", function(j, i){return cfg.color(series)})
                 .style("fill-opacity", cfg.opacityArea)
                 .on('mouseover', function (d){
                          z = "polygon."+d3.select(this).attr("class");
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", 0.1); 
                          g.selectAll(z)
                           .transition(200)
                           .style("fill-opacity", .7);
                          })
                 .on('mouseout', function(){
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", cfg.opacityArea);
                 });
          series++;
        });
        series=0;


        d.forEach(function(y, x){
          g.selectAll(".nodes")
          .data(y).enter()
          .append("svg:circle")
          .attr("class", "radar-chart-serie"+series)
          .attr('r', cfg.radius)
          .attr("alt", function(j){return Math.max(j.value, 0)})
          .attr("cx", function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
          ]);
          return cfg.w/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total));
          })
          .attr("cy", function(j, i){
            return cfg.h/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total));
          })
          .attr("data-id", function(j){return j.axis})
          .style("fill", cfg.color(series)).style("fill-opacity", .9)
          .on('mouseover', function (d){
                newX =  parseFloat(d3.select(this).attr('cx')) - 10;
                newY =  parseFloat(d3.select(this).attr('cy')) - 5;
                
                tooltip
                  .attr('x', newX)
                  .attr('y', newY)
                  .text(Format(d.value))
                  .transition(200)
                  .style('opacity', 1);
                  
                z = "polygon."+d3.select(this).attr("class");
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", 0.1); 
                g.selectAll(z)
                  .transition(200)
                  .style("fill-opacity", .5);
                })
          .on('mouseout', function(){
                tooltip
                  .transition(200)
                  .style('opacity', 0);
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", cfg.opacityArea);
                })
          .append("svg:title")
          .text(function(j){return Math.max(j.value, 0)});

          series++;
        });
        //Tooltip
        tooltip = g.append('text')
               .style('opacity', 0)
               .style('font-family', 'sans-serif')
               .style('font-size', '13px');
        }
      };

      var w = 200,
        h = 200;

      var colorscale = d3.scale.category10();

      //Legend titles
      var LegendOptions = ['Item1','Item2', 'Item3','Item4', 'Item5']; //these should be the neigbourhoods selected.

      //Top 5 Arrays (will be filled with the score function arrays per neighbourhood)
 	//var scores1 =[0.5,0.4,0.2,0.1,0.6,0.6,0.6,1.0];
 	//var scores2 =[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5];
 	//var scores3 =[0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4];
 	//var scores4 =[0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2];
 	//var scores5 =[0.3,0.3,0.3,0.3,0.3,0.3,0.3,0.3];

  
 
      //Data
      // [distance, safety, house pricing, bars, musea, playgrounds, parks, percentage households children]
      var d = [
            [
            {axis:"Distance",value:0},
            {axis:"Safety",value:0},
            {axis:"Bars",value:0},
            {axis:"Best price",value:0},
            {axis:"Musea",value:0},
            {axis:"Playgrounds",value:0},
            {axis:"Parks",value:0},
            {axis:"Children",value:0},
           
            ],            
            [
            {axis:"Distance",value:0},
            {axis:"Safety",value:0},
            {axis:"Bars",value:0},
            {axis:"Best price",value:0},
            {axis:"Musea",value:0},
            {axis:"Playgrounds",value:0},
            {axis:"Parks",value:0},
            {axis:"Children",value:0},
            
          
            ],
            [
            {axis:"Distance",value:0},
            {axis:"Safety",value:0},
            {axis:"Bars",value:0},
            {axis:"Best price",value:0},
            {axis:"Musea",value:0},
            {axis:"Playgrounds",value:0},
            {axis:"Parks",value:0},
            {axis:"Children",value:0},
            
            
            ],           
            [
            {axis:"Distance",value:0},
            {axis:"Safety",value:0},
            {axis:"Bars",value:0},
            {axis:"Best price",value:0},
            {axis:"Musea",value:0},
            {axis:"Playgrounds",value:0},
            {axis:"Parks",value:0},
            {axis:"Children",value:0},
            
            ],
            [
            {axis:"Distance",value:0},
            {axis:"Safety",value:0},
            {axis:"Bars",value:0},
            {axis:"Best price",value:0},
            {axis:"Musea",value:0},
            {axis:"Playgrounds",value:0},
            {axis:"Parks",value:0},
            {axis:"Children",value:0},
            
            ],
          ];
 
 function setVariabled (scores1, scores2, scores3, scores4, scores5){
 
    d = [
            [
            {axis:"Distance",value:(scores1[0]*10)},
            {axis:"Safety",value:(scores1[1]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Best price",value:(scores1[2]*10)},
            {axis:"Musea",value:(scores1[4]*10)}, //
            {axis:"Playgrounds",value:(scores1[5]*10)}, //
            {axis:"Parks",value:(scores1[6]*10)}, //
            {axis:"Children",value:(scores1[7]*10)},
           
            ],            
            [
            {axis:"Distance",value:(scores2[0]*10)},
            {axis:"Safety",value:(scores2[1]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Best price",value:(scores1[2]*10)},
            {axis:"Musea",value:(scores2[4]*10)},
            {axis:"Playgrounds",value:(scores2[5]*10)},
            {axis:"Parks",value:(scores2[6]*10)},
            {axis:"Children",value:(scores2[7]*10)},
            
          
            ],
            [
            {axis:"Distance",value:(scores3[0]*10)},
            {axis:"Safety",value:(scores3[1]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Best price",value:(scores1[2]*10)},
            {axis:"Musea",value:(scores3[4]*10)},
            {axis:"Playgrounds",value:(scores3[5]*10)},
            {axis:"Parks",value:(scores3[6]*10)},
            {axis:"Children",value:(scores3[7]*10)},
            
            
            ],           
            [
            {axis:"Distance",value:(scores4[0]*10)},
            {axis:"Safety",value:(scores4[1]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Best price",value:(scores1[2]*10)},
            {axis:"Musea",value:(scores4[4]*10)},
            {axis:"Playgrounds",value:(scores4[5]*10)},
            {axis:"Parks",value:(scores4[6]*10)},
            {axis:"Children",value:(scores4[7]*10)},
            
            ],
            [
            {axis:"Distance",value:(scores5[0]*10)},
            {axis:"Safety",value:(scores5[1]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Best price",value:(scores1[2]*10)},
            {axis:"Musea",value:(scores5[4]*10)},
            {axis:"Playgrounds",value:(scores5[5]*10)},
            {axis:"Parks",value:(scores5[6]*10)},
            {axis:"Children",value:(scores5[7]*10)},
            
            ],
          ];
      return d;
 }       

      //Options for the Radar chart, other than default
      var mycfg = {
        w: w,
        h: h,
        maxValue: 10,
        levels: 5,
        ExtraWidthX: 300
      }

      //Call function to draw the Radar chart
      //Will expect that data is in %'s
      

      RadarChart.draw("#chart", d, mycfg);

      ////////////////////////////////////////////
      /////////// Initiate legend ////////////////
      ////////////////////////////////////////////

      var svg = d3.select('#chart')
        .selectAll('svg')
        .append('svg')
        .attr("width", w+300)
        .attr("height", h+300);

      //Create the title for the legend
      var text = svg.append("text")
        .attr("class", "title")
        .attr('transform', 'translate(180,0)') 
        .attr("x", w - 350)
        .attr("y",20)
        .attr("font-size", "16px")
        .attr("fill", "#404040")
        .text("Compare up to five neighbourhoods:");
          
       var legend = svg.append("g")
        .attr("class", "legend")
        .attr("height", 100)
        .attr("width", 200)
        .attr('transform', 'translate(-100,270)');
        
         legend.selectAll("rect")
          .data([1,2,3,4,5])
          .enter()
          .append("rect")
          .attr("x", w - 65)
          .attr("y", function(d, i){ return i * 20;})
          .attr("width", 10)
          .attr("height", 10)
          .style("fill", function(d, i){ return colorscale(i);});
 
          
        //Create text next to squares
        legend.selectAll("text")
          .data(LegendOptions)
          .enter()
          .append("text")
          .attr("x", w - 52)
          .attr("y", function(d, i){ return i * 20 + 6;})
          .attr("font-size", "16px")
          .attr("fill", "#737373")
          .text(function(d) { return d; }); 
 
// DOES NOT WORK: why??????? 
function setLegend(scoresNeigh){ 
            
        legend.selectAll('text')
        .data([])
        .exit()
        .remove();

        var yOffset = 180;

        svg = d3.select('#chart')
          .selectAll('svg')
          .append('svg')
          .attr("width", w+300)
          .attr("height", h+400);

        legend = svg.append("g")
          .attr("class", "legend")
          .attr("height", 100)
          .attr("width", 200)
          .attr('transform', 'translate(-100,270)');
 
      var text = svg.append("text")
        .attr("class", "title")
        .attr('transform', 'translate(180,0)') 
        .attr("x", w - 350)
        .attr("y",20)
        .attr("font-size", "16px")
        .attr("fill", "#404040")
        .text("Compare up to five neighbourhoods:");

        
        //Create colour squares
        legend.selectAll("rect")
          .data(scoresNeigh)
          .enter()
          .append("rect")
          .attr("x", w - 65)
          .attr("y", function(d, i){ return i * 20 + yOffset})
          .attr("width", 10)
          .attr("height", 10)
          .style("fill", function(d, i){ return colorscale(i);});
 
          
        //Create text next to squares
        this.legend.selectAll("text")
          .data(scoresNeigh)
          .enter()
          .append("text")
          .attr("x", w - 52)
          .attr("y", function(d, i){ return i * 20 + 10 + yOffset})
          .attr("font-size", "16px")
          .attr("fill", "#737373")
          .text(function(d) { return d; });
          
      }


</script>

<script type="text/javascript"> //loading bar for adress searching.

function loader(config) {
  return function() {
    var radius = Math.min(config.width, config.height) / 3;
    var tau = 2 * Math.PI;

    var arc = d3.svg.arc()
            .innerRadius(radius*0.1)
            .outerRadius(radius*0.3)
            .startAngle(0);

    var svg = d3.select(config.container).append("svg")
        .attr("id", config.id)
        .attr("width", config.width)
        .attr("height", config.height)
      .append("g")
        .attr("transform", "translate(" + config.width / 2 + "," + config.height / 2 + ")")

    var background = svg.append("path")
            .datum({endAngle: 0.63*tau})
            .style("fill", "#4D4D4D")
            .attr("d", arc)
            .call(spin, 1500)

    function spin(selection, duration) {
        selection.transition()
            .ease("linear")
            .duration(duration)
            .attrTween("transform", function() {
                return d3.interpolateString("rotate(0)", "rotate(360)");
            });

        setTimeout(function() { spin(selection, duration); }, duration);
    }

    function transitionFunction(path) {
        path.transition()
            .duration(7500)
            .attrTween("stroke-dasharray", tweenDash)
            .each("end", function() { d3.select(this).call(transition); });
    }

  };
}


var myLoader = loader({width: 200, height: 100, container: "#loader_container", id: "loader"});
myLoader();

</script>


<script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeStudent(){
     document.getElementById('toChange').src='student_c.png';
    }
   </script>
   <script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeFamily(){
     document.getElementById('toChange').src='family_c.png';
    }
   </script>
   <script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeProfessional(){
     document.getElementById('toChange').src='professional_c.png';
    }
   </script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</body>
</html>
