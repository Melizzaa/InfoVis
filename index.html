
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> 

   <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
   <title>InfoVis</title>
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   <link rel="stylesheet" href="style.css">

   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

   <script type="text/javascript" src="d3/d3.js" charset="utf-8"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   <script src="RadarChart.js"></script>
   <script src="d3/d3.slider.js"></script>

   <!-- Leaflet -->
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />



   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>
   <body>
    <div class="overlay">
       <div class="jumbotron">
          <div class="text-center">
            <h1>An interactive housing guide</h1>
            <h2>For those unknown to Amsterdam</h2>
          </div>
       </div>
      <div class="row">
        <div class="col-md-6 col-md-offset-3 text-center">
          <h3>Who are you?</h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 text-center">
          <figure><image src ="student.png"/ onclick="changeStudent()" width="200" height="230" id="student" ></figure>
          <h2>I want:</h2>
          <ul>
            <li>Low house prices</li>
            <li>Live in an exiting area</li>
          </ul>
        </div>
        <div class="col-md-4 text-center">
          <figure><image src ="family.png"/ onclick="changeFamily()" width="200" height="230" id="family" ></figure>
          <h2>I want:</h2>
          <ul>
            <li>A safe neighbourhood</li>
            <li>Places my kids can play outside</li>
            <li>Neighbourhood with many children</li>
          </ul>
        </div>
        <div class="col-md-3 text-center">
          <figure><image src ="professional.png"/ onclick="changeProfessional()" width="200" height="230" id="professional" ></figure>
          <h2>I want:</h2>
          <ul>
            <li>Life close to work</li>
            <li>Have cultural activities in my neighbourhood</li>
          </ul>
        </div>
      </div><!-- row -->
    </div><!-- overlay -->
      <div class="">
        <div class="jumbotron">
            <div class="text-center">
              <h1>An interactive housing guide</h1>
              <h2>For those unknown to Amsterdam</h2>
            </div>
         </div>
         <div class="">
            <div class="col-md-3 sliderArea text-center">
              <p class="text-justify"></p>        
                <form id="back-button-form" style="position:relative;"> <!--back to homescreen button-->
                  <input class="btn btn-default" type="button" onClick="history.go(0)" value="Start screen" style="position: absolute; left:0;">
                </form>
                <figure><img src="house_c.png" id="toChange" height="80" width="80" hspace="100"/></figure>
                <!-- START SLIDERS -->

                <div id="sliderDistance"></div>
                <p>Distance</p>
                <!-- <div id="weightDistance"></div> -->

                <div id="sliderSafety"></div>
                <p>Safety</p>

                <div id="sliderBars"></div>
                <p>Bars and Restaurants</p>

                <div id="sliderPlaygrounds"></div>
                <p>Playgrounds</p>

                <div id="sliderMuseum"></div>
                <p>Museums and Galleries</p>

                <div id="sliderPark"></div>
                <p>Park</p>

                <div id="sliderChildren"></div>
                <p>Amount of Children</p>

                <div id="sliderPrice"></div>
                <p>Housing Price</p>
              </div> <!-- col area -->
            <div class="col-md-6 text-center">
               <div class="area">
                <div id="map"> </div><img src="mapLegend.png" style="position:left" />
             </div>
            </div>
            <div class="col-md-3">
               <div class="area">
                <!--<form name="myform" onSubmit="return handleClick()">
                <input type="text" id="myVal" placeholder="Enter a location&hellip;">
                <input name="Submit"  type="submit" value="Add to map" >
                </form>-->
                <form>
                  <div class="form-group">
                    <label>Select an important location in Amsterdam:</label>
                    <input id="pac-input" class="form-control input-lg controls" type="text" placeholder="Search for a location&hellip;">
                  </div>
                </form>
                
                <div id="chart"></div>
             </div>
            </div>
        </div>
     </div><!-- Container -->



<script type="text/javascript"> //script overlay

// [distance, safety, house pricing, bars, musea, playgrounds, parks, percentage households children]

var SetWeightsStudent = [0, -1, 1, 1, -1, -1, 1, 0];
var SetWeightsFamily = [1, 1, -1, -1, 0, 1, 1, 1];
var SetWeightsProfessional = [1, 0, -1, 1, 1, -1, 0, -1];
var SetWeightsNone=[0,0,0,0,0,0,0,0];

var overlay = $('.overlay'),
    close = $('<button type="button" class="col-md-6 col-md-offset-3 btn btn-primary btn-lg closeOverlay">Let me explore it myself</buton>').on('click', function (){
  createSliders(SetWeightsNone);
  overlay.fadeOut();

}); 


overlay.append(close);

$("#student, close").on('click', function () {
  createSliders(SetWeightsStudent);
  overlay.fadeOut();
}); 

$("#family, close").on('click', function () {
  createSliders(SetWeightsFamily);
  overlay.fadeOut();
}); 

$("#professional, close").on('click', function () {
  createSliders(SetWeightsProfessional);
  overlay.fadeOut();

}); 


</script>

    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>  
    <script type="text/javascript">
    // MAP

    $(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "data/all.csv",
        dataType: "text",
        success: function(data) {
          allHoods = processData(data);
          plotHoods(allHoods);
          //console.log(allHoodsArray);
        }
      });
    });

    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];

      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }

      return lines;

    }

    
    // neighbourhood
    // neighbourhood name
    // coordinates neighbourhood
    // safety
    // normalised safety
    // house price
    // normalised prices score
    // number of bars and restaurants
    // normalised number of bars and restaurants
    // list of bars and restaurants
    // number of musea
    // normalised number of musea
    // list of musea#number of playgrounds
    // normalised number of playgrounds
    // number of parks
    // normalised number of parks
    // list of parks
    // % households with children
    // normalised % households with children

    function plotHoods(allHoods) {
      //console.log(allHoods);
      for (var i = 0; i < allHoods.length; i++) {
        
        polygonHood(allHoods[i][0],allHoods[i][1],allHoods[i][2],allHoods[i][4],allHoods[i][7]);
      }
    }

    function polygonHood(code,name,coords,safetyNorm,nrBars) {
      L.polygon(
        eval(coords),
        style(safetyNorm))
        .addTo(map)
        .bindPopup("<b>" + name + "!</b><br />Nr of bars: " + nrBars);
    }

    function getColor(d) {
      d = d*100
      return d >=100  ? '#006d2c' :
      d > 75   ? '#31a354' :
      d > 50   ? '#74c476' :
      d > 25   ? '#bae4b3' :
      '#edf8e9';
    }

    function style(color) {
      return {
        fillColor: getColor(color),
        weight: 1.5,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.80
      };
    }


     function plotHoodsScores(allHoods, scoresArray) {
      //console.log(allHoods);
      console.log(scoresArray);
      for (var i = 0; i < allHoods.length; i++) {
        
        polygonHoodScores(allHoods[i][0],allHoods[i][1],allHoods[i][2],scoresArray[i]);
      }
    }

    function polygonHoodScores(code,name,coords,scoringValue) {
      L.polygon(
        eval(coords),
        style2(scoringValue))
        .addTo(map);
        //.bindPopup("<b>" + name + "!</b><br />Nr of bars: " + nrBars);
    }

      function style2(color) {
      return {
        fillColor: getColor2(color),
        weight: 1.5,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.45
      };
    }
    
    function getColor2(d) {
      d = d*100
      console.log("colore "+ d);
      return d >= 800 ? '#26BF00' :
      d > 100  ? '#83C800' :
      d > (-100)   ? '#D2BB00' :
      d > (-800)   ? '#DB6000' :
      d > (-1600)   ? '#E50002' :
      '#E50002';
    }

  

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    var map = L.map('map').setView([52.356312, 4.892006], 12);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(map);



    //L.marker([52.355054, 4.954834]).addTo(map).bindPopup("<b>Hello!</b><br />I am at Science Park.").openPopup();

    var popup = L.popup();

    function onMapClick(e) {
      popup
      .setLatLng(e.latlng)
      .setContent("You clicked the map at " + e.latlng.toString())
      .openOn(map);
    }

    //map.on('click', onMapClick);

     </script>


    <script type="text/javascript"> //This is the search bar
 
      // This example adds a search box to a map, using the Google Place Autocomplete
      // feature. People can enter geographical searches. The search box will return a
      // pick list containing a mix of places and predicted search terms.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function initAutocomplete() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -33.8688, lng: 151.2195},
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        // Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        var markers = [];
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }

          // Clear out the old markers.
          markers.forEach(function(marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });
      }

    </script>




    
     <script type="text/javascript"> //SLIDERS: each Slider gives a weight value between -2 and 2
    
     
      $(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "data/all.csv",
        dataType: "text",
        success: function(data) {
          allHoods = processData(data);
          console.log(allHoods);
           console.log(allHoods.length);
            console.log(allHoods[0]);
             console.log(allHoods[0].length);
        }
      });
    });
   
    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];
      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }
      return lines;
    }
     
     function createSliders(weights) {

      d3.select('#sliderDistance').call(d3.slider().value(weights[0]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[0] = value;
          d3.select('#weightDistance').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderSafety').call(d3.slider().value(weights[1]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[1] = value;
          d3.select('#weightSafety').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderBars').call(d3.slider().value(weights[2]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[2] = value;
          d3.select('#weightBars').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderPlaygrounds').call(d3.slider().value(weights[3]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[3] = value;
          d3.select('#weightPlaygrounds').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderMuseum').call(d3.slider().value(weights[4]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[4] = value;
          d3.select('#weightMuseum').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderPark').call(d3.slider().value(weights[5]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[5] = value;
          d3.select('#weightPark').text(value);
          scoringF(allHoods,weights);}));
      d3.select('#sliderChildren').call(d3.slider().value(weights[6]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[6] = value;
          d3.select('#weightChildren').text(value);
          scoringF(allHoods,weights);}));
          //.on("change", function(){weightValues[6] = this.value;  }));
      d3.select('#sliderPrice').call(d3.slider().value(weights[7]).axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          weights[7] = value;
          d3.select('#weightPrice').text(value);
          scoringF(allHoods,weights);})); 
               
    }
    
function scoringF(allHoods,weights){

var scores1 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores2 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores3 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores4 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scores5 = Array.apply(null, Array(8)).map(Number.prototype.valueOf,0);
var scoresNeigh = new Array();
var scores = Array.apply(null, Array(97)).map(Number.prototype.valueOf,0);
//console.log("scores length: " + scores.length);
for (var i=0; i<allHoods.length; i++){
   scores[i] = (weights[1]*parseFloat(allHoods[i][4]) + weights[7]*parseFloat(allHoods[i][6]) + weights[2]*parseFloat(allHoods[i][8]) + weights[4]*parseFloat(allHoods[i][11]) + weights[3]*parseFloat(allHoods[i][14]) + weights[5]*parseFloat(allHoods[i][16]) + weights[6]*parseFloat(allHoods[i][19])).toFixed(2) ;
}
var best = Array.apply(null, Array(5)).map(Number.prototype.valueOf,0);
var index = Array.apply(null, Array(5)).map(Number.prototype.valueOf,0);
for (var q =0; q<best.length; q++){
	best[q] = scores[q];
	index[q] = q;
}
for (var j = 0; j < best.length-1; j++) {
    var iMin = j;
    for (var i = j+1; i < best.length; i++) {
        if (best[i] < best[iMin]) {
            iMin = i;
        }
    }
    if(iMin != j) {
        var temp = best[j];
        best[j] = best[iMin];
        best[iMin] = temp;
        var temp2 = index[j];
        index[j] = index[iMin];
        index[iMin] = temp2;
    }
}
for (var i=5; i<scores.length; i++){
		value = scores[i];
    position = -1
    for (var j=0; j<best.length; j++){
  	   	 var k = 4-j;
         if (value>best[k]){
             position =k;
			       break;      
         }
    }
	  if (position>=0){
		    for (var m=0; m<position; m++){
		         best[m] = best[m+1];
		         index[m] = index[m+1];
        }
		    best[position] = value;
		    index[position] = i;
    }
}  
var ind = [4,6,8,11,14,16,19];  //correspondence with #column for normalized values in csv file
for (var i=0;i<ind.length;i++){
     scores1[i] = allHoods[index[0]][ind[i]] 
     scores2[i] = allHoods[index[1]][ind[i]]
     scores3[i] = allHoods[index[2]][ind[i]]
     scores4[i] = allHoods[index[3]][ind[i]]
     scores5[i] = allHoods[index[4]][ind[i]]
} 
for (var j = 0; j<5; j++){
//console.log(allHoods[index[j]][0]);
scoresNeigh.push(allHoods[index[j]][1]);
}


plotHoodsScores(allHoods, scores);

/*if (label ==0) return;
if (label ==1) return scores1;
if (label ==2) return scores2;
if (label ==3) return scores3;
if (label ==4) return scores4;
if (label ==5) return scores5;
if (label ==6) return index;
if (label ==10) return scores;
*/




return;

}

</script>

<script language="javascript"> //this is the radar chart
      var RadarChart = {
        draw: function(id, d, options){
        var cfg = {
         radius: 3, //size dot
         w: 600, 
         h: 600,
         factor: 1, //zoom in within specified box
         factorLegend: .75, //distance variable name to line
         levels: 3,
         maxValue: 0,
         radians: 2 * Math.PI, //makes it a cirle shape
         opacityArea: 0.3, //of the polygons
         ToRight: 5, //digit index from middle line
         TranslateX: 80, //in box
         TranslateY: 55,
         ExtraWidthX: 100,
         ExtraWidthY: 300,
         color: d3.scale.category10()
        };
        
        if('undefined' !== typeof options){
          for(var i in options){
          if('undefined' !== typeof options[i]){
            cfg[i] = options[i];
          }
          }
        }
        cfg.maxValue = Math.max(cfg.maxValue, d3.max(d, function(i){return d3.max(i.map(function(o){return o.value;}))}));
        var allAxis = (d[0].map(function(i, j){return i.axis}));
        var total = allAxis.length;
        var radius = cfg.factor*Math.min(cfg.w/2, cfg.h/2);
        var Format = d3.format('8,.0f'); //format of legend in radar
        d3.select(id).select("svg").remove();
        
        var g = d3.select(id)
            .append("svg")
            .attr("width", cfg.w+cfg.ExtraWidthX)
            .attr("height", cfg.h+cfg.ExtraWidthY)
            .append("g")
            .attr("transform", "translate(" + cfg.TranslateX + "," + cfg.TranslateY + ")");
            ;

        var tooltip;
        
        //Circular segments
        for(var j=0; j<cfg.levels-1; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data(allAxis)
           .enter()
           .append("svg:line")
           .attr("x1", function(d, i){return levelFactor*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
           .attr("y1", function(d, i){return levelFactor*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
           .attr("x2", function(d, i){return levelFactor*(1-cfg.factor*Math.sin((i+1)*cfg.radians/total));})
           .attr("y2", function(d, i){return levelFactor*(1-cfg.factor*Math.cos((i+1)*cfg.radians/total));})
           .attr("class", "line")
           .style("stroke", "black")
           .style("stroke-opacity", "0.75")
           .style("stroke-width", "0.3px") 
           .attr("transform", "translate(" + (cfg.w/2-levelFactor) + ", " + (cfg.h/2-levelFactor) + ")");
        }

        //Text indicating at what % each level is
        for(var j=0; j<cfg.levels; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data([1]) //dummy data
           .enter()
           .append("svg:text")
           .attr("x", function(d){return levelFactor*(1-cfg.factor*Math.sin(0));})
           .attr("y", function(d){return levelFactor*(1-cfg.factor*Math.cos(0));})
           .attr("class", "legend")
           .style("font-family", "sans-serif")
           .style("font-size", "10px")
           .attr("transform", "translate(" + (cfg.w/2-levelFactor + cfg.ToRight) + ", " + (cfg.h/2-levelFactor) + ")")
           .attr("fill", "#000000")
           .text(Format((j+1)*cfg.maxValue/cfg.levels));
        }
        
        series = 0;

        var axis = g.selectAll(".axis")
            .data(allAxis)
            .enter()
            .append("g")
            .attr("class", "axis");

        axis.append("line")
          .attr("x1", cfg.w/2)
          .attr("y1", cfg.h/2)
          .attr("x2", function(d, i){return cfg.w/2*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
          .attr("y2", function(d, i){return cfg.h/2*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
          .attr("class", "line")
          .style("stroke", "grey")
          .style("stroke-width", "1px");

        axis.append("text")
          .attr("class", "legend")
          .text(function(d){return d})
          .style("font-family", "sans-serif")
          .style("font-size", "14px")
          .attr("text-anchor", "middle")
          .attr("dy", "1.5em")
          .attr("transform", function(d, i){return "translate(0, -10)"})
          .attr("x", function(d, i){return cfg.w/2*(1-cfg.factorLegend*Math.sin(i*cfg.radians/total))-60*Math.sin(i*cfg.radians/total);})
          .attr("y", function(d, i){return cfg.h/2*(1-Math.cos(i*cfg.radians/total))-20*Math.cos(i*cfg.radians/total);});

       
        d.forEach(function(y, x){
          dataValues = [];
          g.selectAll(".nodes")
          .data(y, function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
            ]);
          });
          dataValues.push(dataValues[0]);
          g.selectAll(".area")
                 .data([dataValues])
                 .enter()
                 .append("polygon")
                 .attr("class", "radar-chart-serie"+series)
                 .style("stroke-width", "1px")
                 .style("stroke", cfg.color(series))
                 .attr("points",function(d) {
                   var str="";
                   for(var pti=0;pti<d.length;pti++){
                     str=str+d[pti][0]+","+d[pti][1]+" ";
                   }
                   return str;
                  })
                 .style("fill", function(j, i){return cfg.color(series)})
                 .style("fill-opacity", cfg.opacityArea)
                 .on('mouseover', function (d){
                          z = "polygon."+d3.select(this).attr("class");
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", 0.1); 
                          g.selectAll(z)
                           .transition(200)
                           .style("fill-opacity", .7);
                          })
                 .on('mouseout', function(){
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", cfg.opacityArea);
                 });
          series++;
        });
        series=0;


        d.forEach(function(y, x){
          g.selectAll(".nodes")
          .data(y).enter()
          .append("svg:circle")
          .attr("class", "radar-chart-serie"+series)
          .attr('r', cfg.radius)
          .attr("alt", function(j){return Math.max(j.value, 0)})
          .attr("cx", function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
          ]);
          return cfg.w/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total));
          })
          .attr("cy", function(j, i){
            return cfg.h/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total));
          })
          .attr("data-id", function(j){return j.axis})
          .style("fill", cfg.color(series)).style("fill-opacity", .9)
          .on('mouseover', function (d){
                newX =  parseFloat(d3.select(this).attr('cx')) - 10;
                newY =  parseFloat(d3.select(this).attr('cy')) - 5;
                
                tooltip
                  .attr('x', newX)
                  .attr('y', newY)
                  .text(Format(d.value))
                  .transition(200)
                  .style('opacity', 1);
                  
                z = "polygon."+d3.select(this).attr("class");
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", 0.1); 
                g.selectAll(z)
                  .transition(200)
                  .style("fill-opacity", .5);
                })
          .on('mouseout', function(){
                tooltip
                  .transition(200)
                  .style('opacity', 0);
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", cfg.opacityArea);
                })
          .append("svg:title")
          .text(function(j){return Math.max(j.value, 0)});

          series++;
        });
        //Tooltip
        tooltip = g.append('text')
               .style('opacity', 0)
               .style('font-family', 'sans-serif')
               .style('font-size', '13px');
        }
      };

      var w = 200,
        h = 200;

      var colorscale = d3.scale.category10();

      //Legend titles
      var LegendOptions = ['Item1','Item2', 'Item3','Item4', 'Item5']; //these should be the neigbourhoods selected.

      //Top 5 Arrays (will be filled with the score function arrays per neighbourhood)
 	var scores1 =[0.5,0.4,0.2,0.1,0.6,0.6,0.6,1.0];
 	var scores2 =[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5];
 	var scores3 =[0.4,0.4,0.4,0.4,0.4,0.4,0.4,0.4];
 	var scores4 =[0.1,0.2,0.3,0.1,0.2,0.3,0.1,0.2];
 	var scores5 =[0.3,0.3,0.3,0.3,0.3,0.3,0.3,0.3];
      //Data
      // [distance, safety, house pricing, bars, musea, playgrounds, parks, percentage households children]
      var d = [
            [
            {axis:"Distance",value:(scores1[0]*10)},
            {axis:"Safety",value:(scores1[1]*10)},
            {axis:"Price",value:(scores1[2]*10)},
            {axis:"Bars",value:(scores1[3]*10)},
            {axis:"Musea",value:(scores1[4]*10)},
            {axis:"Playgrounds",value:(scores1[5]*10)},
            {axis:"Parks",value:(scores1[6]*10)},
            {axis:"Children",value:(scores1[7]*10)},
           
            ],            
            [
            {axis:"Distance",value:(scores2[0]*10)},
            {axis:"Safety",value:(scores2[1]*10)},
            {axis:"Price",value:(scores2[2]*10)},
            {axis:"Bars",value:(scores2[3]*10)},
            {axis:"Musea",value:(scores2[4]*10)},
            {axis:"Playgrounds",value:(scores2[5]*10)},
            {axis:"Parks",value:(scores2[6]*10)},
            {axis:"Children",value:(scores2[7]*10)},
            
          
            ],
            [
            {axis:"Distance",value:(scores3[0]*10)},
            {axis:"Safety",value:(scores3[1]*10)},
            {axis:"Price",value:(scores3[2]*10)},
            {axis:"Bars",value:(scores3[3]*10)},
            {axis:"Musea",value:(scores3[4]*10)},
            {axis:"Playgrounds",value:(scores3[5]*10)},
            {axis:"Parks",value:(scores3[6]*10)},
            {axis:"Children",value:(scores3[7]*10)},
            
            
            ],           
            [
            {axis:"Distance",value:(scores4[0]*10)},
            {axis:"Safety",value:(scores4[1]*10)},
            {axis:"Price",value:(scores4[2]*10)},
            {axis:"Bars",value:(scores4[3]*10)},
            {axis:"Musea",value:(scores4[4]*10)},
            {axis:"Playgrounds",value:(scores4[5]*10)},
            {axis:"Parks",value:(scores4[6]*10)},
            {axis:"Children",value:(scores4[7]*10)},
            
            ],
            [
            {axis:"Distance",value:(scores5[0]*10)},
            {axis:"Safety",value:(scores5[1]*10)},
            {axis:"Price",value:(scores5[2]*10)},
            {axis:"Bars",value:(scores5[3]*10)},
            {axis:"Musea",value:(scores5[4]*10)},
            {axis:"Playgrounds",value:(scores5[5]*10)},
            {axis:"Parks",value:(scores5[6]*10)},
            {axis:"Children",value:(scores5[7]*10)},
            
            ],
          ];

      //Options for the Radar chart, other than default
      var mycfg = {
        w: w,
        h: h,
        maxValue: 10,
        levels: 5,
        ExtraWidthX: 300
      }

      //Call function to draw the Radar chart
      //Will expect that data is in %'s
      RadarChart.draw("#chart", d, mycfg);

      ////////////////////////////////////////////
      /////////// Initiate legend ////////////////
      ////////////////////////////////////////////

      var svg = d3.select('#chart')
        .selectAll('svg')
        .append('svg')
        .attr("width", w+300)
        .attr("height", h+300)

      //Create the title for the legend
      var text = svg.append("text")
      .attr("class", "title")
      .attr('transform', 'translate(180,0)') 
        .attr("x", w - 350)
        .attr("y",20)
        .attr("font-size", "16px")
        .attr("fill", "#404040")
        .text("Compare up to five neighbourhoods:");
          
      //Initiate Legend 
      var legend = svg.append("g")
        .attr("class", "legend")
        .attr("height", 100)
        .attr("width", 200)
        .attr('transform', 'translate(-100,270)') 
        ;
        //Create colour squares
        legend.selectAll('rect')
          .data(LegendOptions)
          .enter()
          .append("rect")
          .attr("x", w - 65)
          .attr("y", function(d, i){ return i * 20;})
          .attr("width", 10)
          .attr("height", 10)
          .style("fill", function(d, i){ return colorscale(i);})
          ;
        //Create text next to squares
        legend.selectAll('text')
          .data(LegendOptions)
          .enter()
          .append("text")
          .attr("x", w - 52)
          .attr("y", function(d, i){ return i * 20 + 6;})
          .attr("font-size", "16px")
          .attr("fill", "#737373")
          .text(function(d) { return d; })
          ; 


</script>

<script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeStudent(){
     document.getElementById('toChange').src='student_c.png';
    }
   </script>
   <script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeFamily(){
     document.getElementById('toChange').src='family_c.png';
    }
   </script>
   <script type="text/javascript"> // CHANGE LEGEND IMAGE
    function changeProfessional(){
     document.getElementById('toChange').src='professional_c.png';
    }
   </script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</body>
</html>
