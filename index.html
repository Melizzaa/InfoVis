
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> 

   <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
   <title>InfoVis</title>
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   <link rel="stylesheet" href="style.css">

   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

   <script type="text/javascript" src="d3/d3.js" charset="utf-8"></script>
   <script src="http://d3js.org/d3.v3.min.js"></script>
   <script src="RadarChart.js"></script>
   <script src="d3/d3.slider.js"></script>

   <!-- Leaflet -->
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />



   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>
   <body>
      <div class="">
         <nav class="navbar navbar-default">
            <div class="container-fluid text-center">
               <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                     <span class="sr-only">Toggle navigation</span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="/">InfoVis</a>
               </div>
               <ul class="nav navbar-nav">
                  <li><a href="/">About Us</a></li>
                  <li><a href="/">Help</a></li>
               </ul>
               <!--/.nav-collapse -->
            </div>
            <!--/.container-fluid -->
         </nav>
         <div class="jumbotron">
            <div class="text-center">
              <h1>An interactive housing guide </h1>
              <h2>For those unknown to Amsterdam</h2>
            </div>
         </div>
         <div class="row">
            <div class="col-md-3 text-center">
              <div class="area">
                Legenda Area
                <figure><img src="http://www.echelonna.com/start_students.png" height="80" width="80"/></figure>
                <div id="sliderDistance"></div></br>
                  <div >Distance:   <div id="weightDistance"></div> </div> </br>
                <div id="sliderSafety"></div></br>
                Safety </br></br>
                <div id="sliderBars"></div></br>
                Bars and Restaurants </br></br>
                <div id="sliderPlaygrounds"></div></br>
                Playgrounds </br></br>
                <div id="sliderMuseum"></div></br>
                Museums and Galleries </br></br>
                <div id="sliderPark"></div></br>
                Park</br>
                <div id="sliderChildren"></div></br>
                Amount of Children </br></br>
                <div id="sliderPrice"></div></br>
                Housing Price
              </div> <!-- area -->
            </div>
            <div class="col-md-6 text-center">
               <div class="area">Map Area
                <div id="map"></div>
               <div id="chart1"></div>
             </div>
            </div>
            <div class="col-md-3 text-center">
               <div class="area">Chart area
                <!--<form name="myform" onSubmit="return handleClick()">
                <input type="text" id="myVal" placeholder="Enter a location&hellip;">
                <input name="Submit"  type="submit" value="Add to map" >
                </form>-->
                <input id="pac-input" class="controls" type="text" placeholder="Search for a location&hellip;">
                <div id="map"></div>
                <div id="chart"></div>
             </div>
            </div>
        </div>
        <div class="row">
          <div class="col-md-8">
            <div id="meteo1"></div>
          </div>
        </div>
     </div><!-- Container -->

    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>  
    <script type="text/javascript">
    // MAP

    $(document).ready(function() {
      $.ajax({
        type: "GET",
        url: "file:///Users/Gert/Documents/Master%20Information%20Studies/4%20Information%20Visualization/InfoVis%20Project/InfoVisGitHub/data/coords.txt",
        dataType: "text",
        success: function(data) {
          allHoods = processData(data);
          plotHoods(allHoods);
        }
      });
    });

    function processData(allText) {
      var allTextLines = allText.split(/\r\n|\n/);
      var headers = allTextLines[0].split('#');
      var lines = [];

      for (var i=1; i<allTextLines.length; i++) {
        var data = allTextLines[i].split('#');
        if (data.length == headers.length) {

          var tarr = [];
          for (var j=0; j<headers.length; j++) {
            tarr.push(data[j]);
          }
          lines.push(tarr);
        }
      }

      return lines;

    }

    function plotHoods(allHoods) {
      //console.log(allHoods);
      for (var i = 0; i < allHoods.length; i++) {
        polygonHood(allHoods[i][0],allHoods[i][1],allHoods[i][2]);
      }
    }

    function polygonHood(code,name,coords) {
      L.polygon(
        eval(coords),
        style(getRandomInt(0,100)))
        .addTo(map)
        .bindPopup(name);
    }

    function getColor(d) {
      return d > 100 ? '#26BF00' :
      d > 80  ? '#83C800' :
      d > 60   ? '#D2BB00' :
      d > 40   ? '#DB6000' :
      d > 20   ? '#E50002' :
      '#E50002';
    }

    function style(color) {
      return {
        fillColor: getColor(color),
        weight: 1,
        opacity: 1,
        color: 'white',
        dashArray: '2',
        fillOpacity: 0.4
      };
    }

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    var map = L.map('map').setView([52.356312, 4.892006], 12);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(map);



    L.marker([52.355054, 4.954834]).addTo(map)
    .bindPopup("<b>Hello!</b><br />I am at Science Park.").openPopup();



    var popup = L.popup();

    function onMapClick(e) {
      popup
      .setLatLng(e.latlng)
      .setContent("You clicked the map at " + e.latlng.toString())
      .openOn(map);
    }

    //map.on('click', onMapClick);

     </script>


    <script type="text/javascript"> //This is the search bar
 
      // This example adds a search box to a map, using the Google Place Autocomplete
      // feature. People can enter geographical searches. The search box will return a
      // pick list containing a mix of places and predicted search terms.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      function initAutocomplete() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -33.8688, lng: 151.2195},
          zoom: 13,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        // Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map.addListener('bounds_changed', function() {
          searchBox.setBounds(map.getBounds());
        });

        var markers = [];
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }

          // Clear out the old markers.
          markers.forEach(function(marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });
      }

    </script>




    
     <script type="text/javascript">

      d3.select('#sliderDistance').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightDistance').text(value);}));
      d3.select('#sliderSafety').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightSafety').text(value);}));
      d3.select('#sliderBars').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightBars').text(value);}));
      d3.select('#sliderPlaygrounds').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightPlaygrounds').text(value);}));
      d3.select('#sliderMuseum').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightMuseum').text(value);}));
      d3.select('#sliderPark').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightPark').text(value);}));
      d3.select('#sliderChildren').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightChildren').text(value);}));
      d3.select('#sliderPrice').call(d3.slider().axis(true).min(-2).max(2).step(1).on("slide", function(evt, value) {
          d3.select('#weightPrice').text(value);}));
       

</script>

<script language="javascript"> //this is the radar chart
      var RadarChart = {
        draw: function(id, d, options){
        var cfg = {
         radius: 3, //size dot
         w: 600, 
         h: 600,
         factor: 1, //zoom in within specified box
         factorLegend: .75, //distance variable name to line
         levels: 3,
         maxValue: 0,
         radians: 2 * Math.PI, //makes it a cirle shape
         opacityArea: 0.3, //of the polygons
         ToRight: 5, //digit index from middle line
         TranslateX: 80, //in box
         TranslateY: 30,
         ExtraWidthX: 100,
         ExtraWidthY: 100,
         color: d3.scale.category10()
        };
        
        if('undefined' !== typeof options){
          for(var i in options){
          if('undefined' !== typeof options[i]){
            cfg[i] = options[i];
          }
          }
        }
        cfg.maxValue = Math.max(cfg.maxValue, d3.max(d, function(i){return d3.max(i.map(function(o){return o.value;}))}));
        var allAxis = (d[0].map(function(i, j){return i.axis}));
        var total = allAxis.length;
        var radius = cfg.factor*Math.min(cfg.w/2, cfg.h/2);
        var Format = d3.format('8,.0f'); //format of legend in radar
        d3.select(id).select("svg").remove();
        
        var g = d3.select(id)
            .append("svg")
            .attr("width", cfg.w+cfg.ExtraWidthX)
            .attr("height", cfg.h+cfg.ExtraWidthY)
            .append("g")
            .attr("transform", "translate(" + cfg.TranslateX + "," + cfg.TranslateY + ")");
            ;

        var tooltip;
        
        //Circular segments
        for(var j=0; j<cfg.levels-1; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data(allAxis)
           .enter()
           .append("svg:line")
           .attr("x1", function(d, i){return levelFactor*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
           .attr("y1", function(d, i){return levelFactor*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
           .attr("x2", function(d, i){return levelFactor*(1-cfg.factor*Math.sin((i+1)*cfg.radians/total));})
           .attr("y2", function(d, i){return levelFactor*(1-cfg.factor*Math.cos((i+1)*cfg.radians/total));})
           .attr("class", "line")
           .style("stroke", "black")
           .style("stroke-opacity", "0.75")
           .style("stroke-width", "0.3px") 
           .attr("transform", "translate(" + (cfg.w/2-levelFactor) + ", " + (cfg.h/2-levelFactor) + ")");
        }

        //Text indicating at what % each level is
        for(var j=0; j<cfg.levels; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data([1]) //dummy data
           .enter()
           .append("svg:text")
           .attr("x", function(d){return levelFactor*(1-cfg.factor*Math.sin(0));})
           .attr("y", function(d){return levelFactor*(1-cfg.factor*Math.cos(0));})
           .attr("class", "legend")
           .style("font-family", "sans-serif")
           .style("font-size", "10px")
           .attr("transform", "translate(" + (cfg.w/2-levelFactor + cfg.ToRight) + ", " + (cfg.h/2-levelFactor) + ")")
           .attr("fill", "#000000")
           .text(Format((j+1)*cfg.maxValue/cfg.levels));
        }
        
        series = 0;

        var axis = g.selectAll(".axis")
            .data(allAxis)
            .enter()
            .append("g")
            .attr("class", "axis");

        axis.append("line")
          .attr("x1", cfg.w/2)
          .attr("y1", cfg.h/2)
          .attr("x2", function(d, i){return cfg.w/2*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
          .attr("y2", function(d, i){return cfg.h/2*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
          .attr("class", "line")
          .style("stroke", "grey")
          .style("stroke-width", "1px");

        axis.append("text")
          .attr("class", "legend")
          .text(function(d){return d})
          .style("font-family", "sans-serif")
          .style("font-size", "11px")
          .attr("text-anchor", "middle")
          .attr("dy", "1.5em")
          .attr("transform", function(d, i){return "translate(0, -10)"})
          .attr("x", function(d, i){return cfg.w/2*(1-cfg.factorLegend*Math.sin(i*cfg.radians/total))-60*Math.sin(i*cfg.radians/total);})
          .attr("y", function(d, i){return cfg.h/2*(1-Math.cos(i*cfg.radians/total))-20*Math.cos(i*cfg.radians/total);});

       
        d.forEach(function(y, x){
          dataValues = [];
          g.selectAll(".nodes")
          .data(y, function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
            ]);
          });
          dataValues.push(dataValues[0]);
          g.selectAll(".area")
                 .data([dataValues])
                 .enter()
                 .append("polygon")
                 .attr("class", "radar-chart-serie"+series)
                 .style("stroke-width", "1px")
                 .style("stroke", cfg.color(series))
                 .attr("points",function(d) {
                   var str="";
                   for(var pti=0;pti<d.length;pti++){
                     str=str+d[pti][0]+","+d[pti][1]+" ";
                   }
                   return str;
                  })
                 .style("fill", function(j, i){return cfg.color(series)})
                 .style("fill-opacity", cfg.opacityArea)
                 .on('mouseover', function (d){
                          z = "polygon."+d3.select(this).attr("class");
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", 0.1); 
                          g.selectAll(z)
                           .transition(200)
                           .style("fill-opacity", .7);
                          })
                 .on('mouseout', function(){
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", cfg.opacityArea);
                 });
          series++;
        });
        series=0;


        d.forEach(function(y, x){
          g.selectAll(".nodes")
          .data(y).enter()
          .append("svg:circle")
          .attr("class", "radar-chart-serie"+series)
          .attr('r', cfg.radius)
          .attr("alt", function(j){return Math.max(j.value, 0)})
          .attr("cx", function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
          ]);
          return cfg.w/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total));
          })
          .attr("cy", function(j, i){
            return cfg.h/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total));
          })
          .attr("data-id", function(j){return j.axis})
          .style("fill", cfg.color(series)).style("fill-opacity", .9)
          .on('mouseover', function (d){
                newX =  parseFloat(d3.select(this).attr('cx')) - 10;
                newY =  parseFloat(d3.select(this).attr('cy')) - 5;
                
                tooltip
                  .attr('x', newX)
                  .attr('y', newY)
                  .text(Format(d.value))
                  .transition(200)
                  .style('opacity', 1);
                  
                z = "polygon."+d3.select(this).attr("class");
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", 0.1); 
                g.selectAll(z)
                  .transition(200)
                  .style("fill-opacity", .5);
                })
          .on('mouseout', function(){
                tooltip
                  .transition(200)
                  .style('opacity', 0);
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", cfg.opacityArea);
                })
          .append("svg:title")
          .text(function(j){return Math.max(j.value, 0)});

          series++;
        });
        //Tooltip
        tooltip = g.append('text')
               .style('opacity', 0)
               .style('font-family', 'sans-serif')
               .style('font-size', '13px');
        }
      };

      var w = 200,
        h = 200;

      var colorscale = d3.scale.category10();

      //Legend titles
      var LegendOptions = ['Item1','Item2', 'Item1','Item2', 'Item1']; //these should be the neigbourhoods selected.
 
      //Data
      var d = [
            [
            {axis:"Children",value:6.59},
            {axis:"Variable",value:6.56},
            {axis:"Variable",value:4.42},
            {axis:"Variable",value:4.34},
            {axis:"Variable",value:3.48},
            {axis:"Variable",value:2.14},
            {axis:"Variable",value:8.11},
            {axis:"Variable",value:9.05},
            {axis:"Variable",value:1.07},
            ],            
            [
            {axis:"Children",value:4.07},
            {axis:"Variable",value:4.05},
            {axis:"Variable",value:6.11},
            {axis:"Variable",value:7.14},
            {axis:"Variable",value:7.34},
            {axis:"Variable",value:8.54},
            {axis:"Variable",value:4.38},
            {axis:"Variable",value:5.20},
            {axis:"Variable",value:5.19},
            ],
            [
            {axis:"Children",value:1.09},
            {axis:"Variable",value:2.76},
            {axis:"Variable",value:2.12},
            {axis:"Variable",value:3.34},
            {axis:"Variable",value:4.58},
            {axis:"Variable",value:4.84},
            {axis:"Variable",value:5.91},
            {axis:"Variable",value:8.15},
            {axis:"Variable",value:8.07},
            ],            
            [
            {axis:"Children",value:3.07},
            {axis:"Variable",value:3.05},
            {axis:"Variable",value:3.41},
            {axis:"Variable",value:4.04},
            {axis:"Variable",value:5.24},
            {axis:"Variable",value:1.44},
            {axis:"Variable",value:3.58},
            {axis:"Variable",value:2.10},
            {axis:"Variable",value:4.09},
            ],
            [
            {axis:"Children",value:9.48},
            {axis:"Variable",value:8.41},
            {axis:"Variable",value:8.27},
            {axis:"Variable",value:3.28},
            {axis:"Variable",value:4.46},
            {axis:"Variable",value:6.29},
            {axis:"Variable",value:7.11},
            {axis:"Variable",value:4.14},
            {axis:"Variable",value:2.05},
            ]
          ];

      //Options for the Radar chart, other than default
      var mycfg = {
        w: w,
        h: h,
        maxValue: 0.6,
        levels: 6,
        ExtraWidthX: 300
      }

      //Call function to draw the Radar chart
      //Will expect that data is in %'s
      RadarChart.draw("#chart", d, mycfg);

      ////////////////////////////////////////////
      /////////// Initiate legend ////////////////
      ////////////////////////////////////////////

      var svg = d3.select('#chart')
        .selectAll('svg')
        .append('svg')
        .attr("width", w+300)
        .attr("height", h)

      //Create the title for the legend
      var text = svg.append("text")
        .attr("class", "title")
        .attr('transform', 'translate(180,0)') 
        .attr("x", w - 70)
        .attr("y", 10)
        .attr("font-size", "10px")
        .attr("fill", "#404040")
        .text("text - legenda titel");
          
      //Initiate Legend 
      var legend = svg.append("g")
        .attr("class", "legend")
        .attr("height", 100)
        .attr("width", 200)
        .attr('transform', 'translate(180,20)') 
        ;
        //Create colour squares
        legend.selectAll('rect')
          .data(LegendOptions)
          .enter()
          .append("rect")
          .attr("x", w - 65)
          .attr("y", function(d, i){ return i * 20;})
          .attr("width", 6)
          .attr("height", 6)
          .style("fill", function(d, i){ return colorscale(i);})
          ;
        //Create text next to squares
        legend.selectAll('text')
          .data(LegendOptions)
          .enter()
          .append("text")
          .attr("x", w - 52)
          .attr("y", function(d, i){ return i * 20 + 6;})
          .attr("font-size", "9px")
          .attr("fill", "#737373")
          .text(function(d) { return d; })
          ; 


</script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</body>
</html>
