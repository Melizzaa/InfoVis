
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> <!--new, radarchart big-->

   <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
   <title>InfoVis</title>
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
   <link rel="stylesheet" href="style.css">

   <script type="text/javascript" src="d3/d3.js" charset="utf-8"></script>
  <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
  <script src="https://www.amcharts.com/lib/3/radar.js"></script>
  <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>

<!--new-->
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="RadarChart.js"></script>
  <style>
    body {
      overflow: hidden;
      margin: 0;
      font-size: 14px;
      font-family: "Helvetica Neue", Helvetica;
    }

    #chart {
      position: absolute;
      top: 50px;
      left: 100px;
    } 
  </style><!--new-->

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
   </head>
   <body>
      <div class="container">
         <nav class="navbar navbar-default">
            <div class="container-fluid">
               <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                     <span class="sr-only">Toggle navigation</span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="/">InfoVis</a>
               </div>
               <ul class="nav navbar-nav">
                  <li><a href="/">About Us</a></li>
                  <li><a href="/">Help</a></li>
               </ul>
               <!--/.nav-collapse -->
            </div>
            <!--/.container-fluid -->
         </nav>
         <div class="jumbotron">
            <h1>An interactive housing guide </h1>
            <h2>For those unknown to Amsterdam</h2>  
         </div>
         <div class="row">
            <div class="col-md-3 text-center">
              <div class="area">
                Legenda Area
                <figure><img src="http://www.echelonna.com/start_students.png" height="80" width="80"/></figure>
              </div>
            </div>
            <div class="col-md-6 text-center">
               <div class="area">Map Area
               <div id="chart"></div><!--new-->
             </div>
            </div>
            <div class="col-md-3 text-center">
               <div class="area">Chart area
               <div id="meteo1"></div>
               <div id="chartdiv"></div>
             </div>
            </div>
        </div>
        <div class="row">
          <div class="col-md-8">
            <div id="meteo1"></div>
          </div>
        </div>
     </div><!-- Container -->

      <script language="javascript">
      var RadarChart = {
        draw: function(id, d, options){
        var cfg = {
         radius: 3, //size dot
         w: 100, 
         h: 600,
         factor: 1,
         factorLegend: .85,
         levels: 3,
         maxValue: 0,
         radians: 2 * Math.PI,
         opacityArea: 0.5,
         ToRight: 5,
         TranslateX: 80,
         TranslateY: 30,
         ExtraWidthX: 100,
         ExtraWidthY: 100,
         color: d3.scale.category10()
        };
        
        if('undefined' !== typeof options){
          for(var i in options){
          if('undefined' !== typeof options[i]){
            cfg[i] = options[i];
          }
          }
        }
        cfg.maxValue = Math.max(cfg.maxValue, d3.max(d, function(i){return d3.max(i.map(function(o){return o.value;}))}));
        var allAxis = (d[0].map(function(i, j){return i.axis}));
        var total = allAxis.length;
        var radius = cfg.factor*Math.min(cfg.w/2, cfg.h/2);
        var Format = d3.format('%');
        d3.select(id).select("svg").remove();
        
        var g = d3.select(id)
            .append("svg")
            .attr("width", cfg.w+cfg.ExtraWidthX)
            .attr("height", cfg.h+cfg.ExtraWidthY)
            .append("g")
            .attr("transform", "translate(" + cfg.TranslateX + "," + cfg.TranslateY + ")");
            ;

        var tooltip;
        
        //Circular segments
        for(var j=0; j<cfg.levels-1; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data(allAxis)
           .enter()
           .append("svg:line")
           .attr("x1", function(d, i){return levelFactor*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
           .attr("y1", function(d, i){return levelFactor*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
           .attr("x2", function(d, i){return levelFactor*(1-cfg.factor*Math.sin((i+1)*cfg.radians/total));})
           .attr("y2", function(d, i){return levelFactor*(1-cfg.factor*Math.cos((i+1)*cfg.radians/total));})
           .attr("class", "line")
           .style("stroke", "grey")
           .style("stroke-opacity", "0.75")
           .style("stroke-width", "0.3px")
           .attr("transform", "translate(" + (cfg.w/2-levelFactor) + ", " + (cfg.h/2-levelFactor) + ")");
        }

        //Text indicating at what % each level is
        for(var j=0; j<cfg.levels; j++){
          var levelFactor = cfg.factor*radius*((j+1)/cfg.levels);
          g.selectAll(".levels")
           .data([1]) //dummy data
           .enter()
           .append("svg:text")
           .attr("x", function(d){return levelFactor*(1-cfg.factor*Math.sin(0));})
           .attr("y", function(d){return levelFactor*(1-cfg.factor*Math.cos(0));})
           .attr("class", "legend")
           .style("font-family", "sans-serif")
           .style("font-size", "10px")
           .attr("transform", "translate(" + (cfg.w/2-levelFactor + cfg.ToRight) + ", " + (cfg.h/2-levelFactor) + ")")
           .attr("fill", "#737373")
           .text(Format((j+1)*cfg.maxValue/cfg.levels));
        }
        
        series = 0;

        var axis = g.selectAll(".axis")
            .data(allAxis)
            .enter()
            .append("g")
            .attr("class", "axis");

        axis.append("line")
          .attr("x1", cfg.w/2)
          .attr("y1", cfg.h/2)
          .attr("x2", function(d, i){return cfg.w/2*(1-cfg.factor*Math.sin(i*cfg.radians/total));})
          .attr("y2", function(d, i){return cfg.h/2*(1-cfg.factor*Math.cos(i*cfg.radians/total));})
          .attr("class", "line")
          .style("stroke", "grey")
          .style("stroke-width", "1px");

        axis.append("text")
          .attr("class", "legend")
          .text(function(d){return d})
          .style("font-family", "sans-serif")
          .style("font-size", "11px")
          .attr("text-anchor", "middle")
          .attr("dy", "1.5em")
          .attr("transform", function(d, i){return "translate(0, -10)"})
          .attr("x", function(d, i){return cfg.w/2*(1-cfg.factorLegend*Math.sin(i*cfg.radians/total))-60*Math.sin(i*cfg.radians/total);})
          .attr("y", function(d, i){return cfg.h/2*(1-Math.cos(i*cfg.radians/total))-20*Math.cos(i*cfg.radians/total);});

       
        d.forEach(function(y, x){
          dataValues = [];
          g.selectAll(".nodes")
          .data(y, function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
            ]);
          });
          dataValues.push(dataValues[0]);
          g.selectAll(".area")
                 .data([dataValues])
                 .enter()
                 .append("polygon")
                 .attr("class", "radar-chart-serie"+series)
                 .style("stroke-width", "2px")
                 .style("stroke", cfg.color(series))
                 .attr("points",function(d) {
                   var str="";
                   for(var pti=0;pti<d.length;pti++){
                     str=str+d[pti][0]+","+d[pti][1]+" ";
                   }
                   return str;
                  })
                 .style("fill", function(j, i){return cfg.color(series)})
                 .style("fill-opacity", cfg.opacityArea)
                 .on('mouseover', function (d){
                          z = "polygon."+d3.select(this).attr("class");
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", 0.1); 
                          g.selectAll(z)
                           .transition(200)
                           .style("fill-opacity", .7);
                          })
                 .on('mouseout', function(){
                          g.selectAll("polygon")
                           .transition(200)
                           .style("fill-opacity", cfg.opacityArea);
                 });
          series++;
        });
        series=0;


        d.forEach(function(y, x){
          g.selectAll(".nodes")
          .data(y).enter()
          .append("svg:circle")
          .attr("class", "radar-chart-serie"+series)
          .attr('r', cfg.radius)
          .attr("alt", function(j){return Math.max(j.value, 0)})
          .attr("cx", function(j, i){
            dataValues.push([
            cfg.w/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total)), 
            cfg.h/2*(1-(parseFloat(Math.max(j.value, 0))/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total))
          ]);
          return cfg.w/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.sin(i*cfg.radians/total));
          })
          .attr("cy", function(j, i){
            return cfg.h/2*(1-(Math.max(j.value, 0)/cfg.maxValue)*cfg.factor*Math.cos(i*cfg.radians/total));
          })
          .attr("data-id", function(j){return j.axis})
          .style("fill", cfg.color(series)).style("fill-opacity", .9)
          .on('mouseover', function (d){
                newX =  parseFloat(d3.select(this).attr('cx')) - 10;
                newY =  parseFloat(d3.select(this).attr('cy')) - 5;
                
                tooltip
                  .attr('x', newX)
                  .attr('y', newY)
                  .text(Format(d.value))
                  .transition(200)
                  .style('opacity', 1);
                  
                z = "polygon."+d3.select(this).attr("class");
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", 0.1); 
                g.selectAll(z)
                  .transition(200)
                  .style("fill-opacity", .7);
                })
          .on('mouseout', function(){
                tooltip
                  .transition(200)
                  .style('opacity', 0);
                g.selectAll("polygon")
                  .transition(200)
                  .style("fill-opacity", cfg.opacityArea);
                })
          .append("svg:title")
          .text(function(j){return Math.max(j.value, 0)});

          series++;
        });
        //Tooltip
        tooltip = g.append('text')
               .style('opacity', 0)
               .style('font-family', 'sans-serif')
               .style('font-size', '13px');
        }
      };

      var w = 300,
        h = 300;

      var colorscale = d3.scale.category10();

      //Legend titles
      var LegendOptions = ['Item1','Item2'];

      //Data
      var d = [
            [
            {axis:"Variable",value:0.59},
            {axis:"Variable",value:0.56},
            {axis:"Variable",value:0.42},
            {axis:"Variable",value:0.34},
            {axis:"Variable",value:0.48},
            {axis:"Variable",value:0.14},
            {axis:"Variable",value:0.11},
            {axis:"Variable",value:0.05},
            {axis:"Variable",value:0.07},
            ],            
            [
            {axis:"Variable",value:0.07},
            {axis:"Variable",value:0.05},
            {axis:"Variable",value:0.11},
            {axis:"Variable",value:0.14},
            {axis:"Variable",value:0.34},
            {axis:"Variable",value:0.54},
            {axis:"Variable",value:0.38},
            {axis:"Variable",value:0.20},
            {axis:"Variable",value:0.19},
            ],
            [
            {axis:"Variable",value:0.09},
            {axis:"Variable",value:0.76},
            {axis:"Variable",value:0.12},
            {axis:"Variable",value:0.34},
            {axis:"Variable",value:0.58},
            {axis:"Variable",value:0.84},
            {axis:"Variable",value:0.91},
            {axis:"Variable",value:0.15},
            {axis:"Variable",value:0.07},
            ],            
            [
            {axis:"Variable",value:0.07},
            {axis:"Variable",value:0.05},
            {axis:"Variable",value:0.41},
            {axis:"Variable",value:0.04},
            {axis:"Variable",value:0.24},
            {axis:"Variable",value:0.44},
            {axis:"Variable",value:0.58},
            {axis:"Variable",value:0.10},
            {axis:"Variable",value:0.09},
            ],
            [
            {axis:"Variable",value:0.48},
            {axis:"Variable",value:0.41},
            {axis:"Variable",value:0.27},
            {axis:"Variable",value:0.28},
            {axis:"Variable",value:0.46},
            {axis:"Variable",value:0.29},
            {axis:"Variable",value:0.11},
            {axis:"Variable",value:0.14},
            {axis:"Variable",value:0.05},
            ]
          ];

      //Options for the Radar chart, other than default
      var mycfg = {
        w: w,
        h: h,
        maxValue: 0.6,
        levels: 6,
        ExtraWidthX: 300
      }

      //Call function to draw the Radar chart
      //Will expect that data is in %'s
      RadarChart.draw("#chart", d, mycfg);

      ////////////////////////////////////////////
      /////////// Initiate legend ////////////////
      ////////////////////////////////////////////

      var svg = d3.select('#body')
        .selectAll('svg')
        .append('svg')
        .attr("width", w+300)
        .attr("height", h)

      //Create the title for the legend
      var text = svg.append("text")
        .attr("class", "title")
        .attr('transform', 'translate(90,0)') 
        .attr("x", w - 70)
        .attr("y", 10)
        .attr("font-size", "12px")
        .attr("fill", "#404040")
        .text("What % of owners use a specific service in a week");
          
      //Initiate Legend 
      var legend = svg.append("g")
        .attr("class", "legend")
        .attr("height", 100)
        .attr("width", 200)
        .attr('transform', 'translate(90,20)') 
        ;
        //Create colour squares
        legend.selectAll('rect')
          .data(LegendOptions)
          .enter()
          .append("rect")
          .attr("x", w - 65)
          .attr("y", function(d, i){ return i * 20;})
          .attr("width", 10)
          .attr("height", 10)
          .style("fill", function(d, i){ return colorscale(i);})
          ;
        //Create text next to squares
        legend.selectAll('text')
          .data(LegendOptions)
          .enter()
          .append("text")
          .attr("x", w - 52)
          .attr("y", function(d, i){ return i * 20 + 9;})
          .attr("font-size", "11px")
          .attr("fill", "#737373")
          .text(function(d) { return d; })
          ; 


      </script>

      <script type="text/javascript">
      //http://docs.amcharts.com/3/javascriptcharts/AmRadarChart
      var chart = AmCharts.makeChart( "chartdiv", {
        "type": "radar",
        "theme": "dark",
        "dataProvider": [ {
          "variable": "Safety",
          "number": 156.9
        }, {
          "variable": "Kids",
          "number": 131.1
        }, {
          "variable": "Travel",
          "number": 115.8
        }, {
          "variable": "Work",
          "number": 109.9
        }, {
          "variable": "Bars",
          "number": 108.3
        }, {
          "variable": "Musea",
          "number": 99
        } ],
        "valueAxes": [ {
          "axisTitleOffset": 10,
          "minimum": 5,
          "axisAlpha": 0.35
        } ],
        "graphs": [ {
          "bullet": "circle",
          "valueField": "number"
        } ],
        "categoryField": "variable",
        "export": {
          "enabled": true
        }
      } );
      </script>



     <script type="text/javascript">
  // 5 transform the data
  //var avgTempsPerMonth = [];
  var avgTemps2015 = new Array(12);
  var totalTempsPerMonth2015 = new Array(12);
  var daysPerMonth2015 = new Array(12);
  for (var i = 0; i < avgTemps2015.length; i++) {
    avgTemps2015[i] = 0;
    totalTempsPerMonth2015[i] = 0;
    daysPerMonth2015[i] = 0;
  };
  var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

  function calcAvg() {
    for (var i = 0; i < 12; i++) {
      avgTemps2015[i] = (totalTempsPerMonth2015[i] / daysPerMonth2015[i]).toFixed(1);
    }
  }

  function maxRange(max) {
    if (max % 5 === 0) {
      return max+5;
    } else {
      return max+5-(max % 5);
    };
  }

  var year = 2015;


  d3.csv("meteo.csv", function(data) {
    var thisMonth = 1;
    var totalThisMonth = 0;
    var totalDaysThisMonth = 1;
    for (var i = 0; i < data.length; i++) {
      if (data[i].year == year) {
        var index = parseInt(data[i].month)-1;
        totalTempsPerMonth2015[index] += parseInt(data[i].temperature) / 10;
        daysPerMonth2015[index]++;


        // if (parseInt(data[i].month) != thisMonth) { //maand voorbij
        //   avgTemps2015[thisMonth-1] = (totalThisMonth / totalDaysThisMonth);
        //   console.log(avgTemps2015[thisMonth-1]);
        //   thisMonth = parseInt(data[i].month);
        //   totalDaysThisMonth = 0;
        //   totalThisMonth = 0;
        // }
        //totalThisMonth += parseInt(data[i].temperature) / 10;
        //totalDaysThisMonth += 1;
      }
    };
    calcAvg();
    //console.log(avgTemps2015);
    data = avgTemps2015;
    var h = 100;
    var w = 250;
    var offset = 16; // verhoging voor de x-as
    var padding = 30; //links van de y-as
    var barPadding = 1;
    var maxValue = Math.max.apply(Math, data);

    var yScale = d3.scale.linear()
    .domain([0, maxRange(maxValue)])
    .range([h, offset+10]);

    //console.log(yScale(5));

    var svg = d3.select("#meteo1")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

    svg.selectAll("rect")
    .data(data)
    .enter()
    .append("rect")
    .attr("x", function(d, i) {
      return i * ((w-padding) / data.length)+ padding;
    })
    .attr("y", function(d) {
      return yScale(d)-offset; // y coordinaat vanaf boven gezien.
    })
    .attr("width", (w-padding) / data.length - barPadding)
    .attr("height", function(d) {
      return h-(yScale(d));
    })
    .attr("fill", function(d) {
      //return "rgb(" + (200*(d/maxValue)).toFixed(0) + ", " + (200*(d/maxValue)).toFixed(0) + ", " + (200*(d/maxValue)).toFixed(0) + ")";
      return "rgb(254,165,1)";
    });

  // Values
  svg.selectAll("text.values")
  .data(data)
  .enter()
  .append("text")
  .text(function(d) {
    return d;
  })
  .attr("text-anchor", "middle")
  .attr("x", function(d, i) {
    return i * ((w-padding) / data.length) + (w / data.length - barPadding) / 2 + padding - 1; //midden van bar //
  })
  .attr("y", function(d) {
    return yScale(d)-offset+14;
  })
  .attr("font-family", "sans-serif")
  .attr("font-size", "11px")
  .attr("fill", "black")

  // Months
  svg.selectAll("text.monts")
  .data(months)
  .enter()
  .append("text")
  .text(function(d) {
    return d;
  })
  .attr("text-anchor", "middle")
  .attr("x", function(d, i) {
    return i * ((w-padding) / data.length) + (w / data.length - barPadding) / 2 + padding; //midden van bar
  })
  .attr("y", function(d) {
    return h-4; //anders vallen sommige letters er van af
  })
  .attr("font-family", "sans-serif")
  .attr("font-size", "12px")
  .attr("fill", "black");

  // Y AXIS
  //Define Y axis
  var yAxis = d3.svg.axis()
  .scale(yScale)
  .orient("left")
  .ticks(5);

  //Create Y axis
  svg.append("g")
  .attr("class", "axis")
  .attr("transform", "translate(" + padding + ",-"+offset+")")
  .call(yAxis);

});
</script>
     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <!-- Latest compiled and minified JavaScript -->
     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  </body>
  </html>
